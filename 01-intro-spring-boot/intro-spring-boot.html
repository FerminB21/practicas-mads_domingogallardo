



<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copiar al portapapeles">
      
        <meta name="lang:clipboard.copied" content="Copiado al portapapeles">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No se encontraron documentos">
      
        <meta name="lang:search.result.one" content="1 documento encontrado">
      
        <meta name="lang:search.result.other" content="# documentos encontrados">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1, mkdocs-material-4.6.3">
    
    
      
        <title>Introducción a Spring Boot - Prácticas MADS</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.adb8469c.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="#009688">
      
    
    
      <script src="../assets/javascripts/modernizr.86422ebf.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Ubuntu","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="teal" data-md-color-accent="teal">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#introduccion-a-spring-boot" tabindex="0" class="md-skip">
        Saltar a contenido
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="Prácticas MADS" aria-label="Prácticas MADS" class="md-header-nav__button md-logo">
          
            <img alt="logo" src="../imagenes/logo.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Prácticas MADS
            </span>
            <span class="md-header-nav__topic">
              
                Introducción a Spring Boot
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" aria-label="search" name="query" placeholder="Búsqueda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Teclee para comenzar búsqueda
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="Prácticas MADS" class="md-nav__button md-logo">
      
        <img alt="logo" src="../imagenes/logo.png" width="48" height="48">
      
    </a>
    Prácticas MADS
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1" checked>
    
    <label class="md-nav__link" for="nav-1">
      Práctica 1
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        Práctica 1
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="practica0.html" title="Primera aplicación con Spring Boot" class="md-nav__link">
      Primera aplicación con Spring Boot
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Introducción a Spring Boot
      </label>
    
    <a href="intro-spring-boot.html" title="Introducción a Spring Boot" class="md-nav__link md-nav__link--active">
      Introducción a Spring Boot
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Tabla de contenidos</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#descarga-de-la-aplicacion-ejemplo" class="md-nav__link">
    Descarga de la aplicación ejemplo
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ejecucion-de-aplicaciones-spring-boot" class="md-nav__link">
    Ejecución de aplicaciones Spring Boot
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#desarrollo-y-ejecucion-con-intellij" class="md-nav__link">
    Desarrollo y ejecución con IntelliJ
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conceptos-de-spring-boot" class="md-nav__link">
    Conceptos de Spring Boot
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#estructura-de-la-aplicacion" class="md-nav__link">
    Estructura de la aplicación
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#controladores" class="md-nav__link">
    Controladores
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clases-de-servicio" class="md-nav__link">
    Clases de Servicio
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inyeccion-de-dependencias-en-spring" class="md-nav__link">
    Inyección de dependencias en Spring
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#plantillas-thymeleaf" class="md-nav__link">
    Plantillas Thymeleaf
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tests" class="md-nav__link">
    Tests
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#referencias" class="md-nav__link">
    Referencias
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="comandos-git.html" title="Comandos Git" class="md-nav__link">
      Comandos Git
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="practica1.html" title="Aplicación ToDoList" class="md-nav__link">
      Aplicación ToDoList
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../02-pruebas-tdd/integration-tdd.html" title="Práctica 2" class="md-nav__link">
      Práctica 2
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Tabla de contenidos</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#descarga-de-la-aplicacion-ejemplo" class="md-nav__link">
    Descarga de la aplicación ejemplo
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ejecucion-de-aplicaciones-spring-boot" class="md-nav__link">
    Ejecución de aplicaciones Spring Boot
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#desarrollo-y-ejecucion-con-intellij" class="md-nav__link">
    Desarrollo y ejecución con IntelliJ
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conceptos-de-spring-boot" class="md-nav__link">
    Conceptos de Spring Boot
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#estructura-de-la-aplicacion" class="md-nav__link">
    Estructura de la aplicación
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#controladores" class="md-nav__link">
    Controladores
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clases-de-servicio" class="md-nav__link">
    Clases de Servicio
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inyeccion-de-dependencias-en-spring" class="md-nav__link">
    Inyección de dependencias en Spring
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#plantillas-thymeleaf" class="md-nav__link">
    Plantillas Thymeleaf
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tests" class="md-nav__link">
    Tests
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#referencias" class="md-nav__link">
    Referencias
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="introduccion-a-spring-boot">Introducción a Spring Boot<a class="headerlink" href="#introduccion-a-spring-boot" title="Permanent link">&para;</a></h1>
<h2 id="descarga-de-la-aplicacion-ejemplo">Descarga de la aplicación ejemplo<a class="headerlink" href="#descarga-de-la-aplicacion-ejemplo" title="Permanent link">&para;</a></h2>
<p>Es muy sencillo crear aplicaciones de Spring Boot <strong>desde cero</strong> usando la
web <a href="https://start.spring.io">Spring initializr</a>. En esa página puedes
configurar los metadatos del proyecto y sus dependencias y descargar
el proyecto como un ZIP con la estructura de directorios y el POM
ya configurados. </p>
<p>Nosotros vamos a hacerlo más fácil todavía usando una aplicación
ejemplo en
GitHub <a href="https://github.com/domingogallardo/spring-boot-demoapp">domingogallardo/spring-boot-demoapp</a>. Puedes
descargarla usando Git:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>$ git clone https://github.com/domingogallardo/spring-boot-demoapp.git
</code></pre></div>
</td></tr></table>

<p>La aplicación es un sencillo <code>Hola mundo</code>. En los siguientes apartados
explicamos cómo lanzarla y cómo funciona.</p>
<h2 id="ejecucion-de-aplicaciones-spring-boot">Ejecución de aplicaciones Spring Boot<a class="headerlink" href="#ejecucion-de-aplicaciones-spring-boot" title="Permanent link">&para;</a></h2>
<p>Spring Boot permite ejecutar aplicaciones Spring de forma
<em>standalone</em>, sin necesidad de un servidor de aplicaciones. Una
aplicación Spring Boot lleva incluido un servidor web embebido
(Tomcat) que se pone en marcha al lanzar la aplicación y sirve todas
las páginas de la aplicación web.</p>
<p>Para lanzar una aplicación Spring Boot es suficiente tener instalados:</p>
<ul>
<li>JDK Java (8 en adelante)</li>
<li>Maven</li>
</ul>
<p>Maven incluso no es necesario si la aplicación Spring Boot lo tiene ya
instalado utilizando <a href="https://github.com/takari/maven-wrapper">Maven
Wrapper</a>, como es el caso de
la aplicación ejemplo.</p>
<p>Desde el directorio donde está la aplicación que queremos lanzar
podemos arrancarla como una aplicación Java. Podemos llamar a <code>mvn</code> si
tenemos instalado Maven o a <code>./mvnw</code> para usar Maven Wrapper:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>$ ./mvnw package
$ java -jar target/demoapp-0.0.1-SNAPSHOT.jar 
</code></pre></div>
</td></tr></table>

<p>También podemos lanzarla usando el plugin <code>spring-boot</code> de Maven:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>$ ./mvnw spring-boot:run
</code></pre></div>
</td></tr></table>

<p>La aplicación se arranca por defecto en el puerto local 8080. Una vez
arrancada la aplicación podemos conectarnos desde un navegador a sus
páginas de inicio.</p>
<p>En el caso de la aplicación demo descargada, podemos probar las
siguientes páginas:</p>
<ul>
<li><a href="http://localhost:8080">http://localhost:8080</a></li>
<li><a href="http://localhost:8080/saludo/Pepito">http://localhost:8080/saludo/Pepito</a></li>
<li><a href="http://localhost:8080/saludoplantilla/Pepito">http://localhost:8080/saludoplantilla/Pepito</a></li>
</ul>
<h2 id="desarrollo-y-ejecucion-con-intellij">Desarrollo y ejecución con IntelliJ<a class="headerlink" href="#desarrollo-y-ejecucion-con-intellij" title="Permanent link">&para;</a></h2>
<p>Recomendamos hacer el desarrollo usando el IDE <a href="https://www.jetbrains.com/idea/download/">IntelliJ
Ultimate</a>. Aunque es de
pago, es posible <a href="https://www.jetbrains.com/shop/eform/students">obtener una licencia de
estudiante</a> usando la
dirección de correo de la UA.</p>
<p>Para importar un proyecto Spring Boot en IntelliJ basta con
importar el directorio donde se encuentre el fichero <code>pom.xml</code>. Se
puede hacer desde la pantalla de bienvenida de IntelliJ con la opción
<strong>Import Project</strong> o usando la opción <strong>File &gt; New &gt; Project from
Existing Sources</strong>. Aparecerá la pantalla de importación y
seleccionamos el importador <strong>Maven</strong>:</p>
<p><img src="imagenes/import-intellij.png" width="600px" /></p>
<p>IntelliJ importa el proyecto correctamente:</p>
<p><img src="imagenes/proyecto-desplegado.png" width="300px"/></p>
<p>Podemos ejecutarlo abriendo un terminal y lanzándolo con Maven. O
también desde la <strong>configuración de Run</strong> que ha creado IntelliJ al
realizar la importación:</p>
<p><img src="imagenes/configuracion-run.png" width="250px"/></p>
<p>Se abrirá un panel de ejecución desde el que se puede parar la
aplicación, volverla a lanzar, etc:</p>
<p><img src="imagenes/panel-ejecucion.png" width="900px"/></p>
<h2 id="conceptos-de-spring-boot">Conceptos de Spring Boot<a class="headerlink" href="#conceptos-de-spring-boot" title="Permanent link">&para;</a></h2>
<h3 id="estructura-de-la-aplicacion">Estructura de la aplicación<a class="headerlink" href="#estructura-de-la-aplicacion" title="Permanent link">&para;</a></h3>
<p>Estructura de directorios típica de los proyectos Java construidos con
Maven:</p>
<p><img src="imagenes/estructura-app.png" width="300px"/></p>
<p>El fichero <code>pom.xml</code> declara las dependencias. Spring Boot proporciona
<em>starters</em> que agrupan un conjunto de dependencias comunes.</p>
<p><strong>Fichero <code>pom.xml</code></strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> 
         <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
         <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0 </span>
<span class="s">         https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>

    <span class="nt">&lt;groupId&gt;</span>es.ua.mads<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>demoapp<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>0.0.1-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;name&gt;</span>demoapp<span class="nt">&lt;/name&gt;</span>

    <span class="nt">&lt;parent&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-parent<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>2.1.16.RELEASE<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/parent&gt;</span>

    <span class="nt">&lt;properties&gt;</span>
        <span class="nt">&lt;java.version&gt;</span>1.8<span class="nt">&lt;/java.version&gt;</span>
    <span class="nt">&lt;/properties&gt;</span>

    <span class="nt">&lt;dependencies&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-web<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-thymeleaf<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-test<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;/dependencies&gt;</span>

    <span class="nt">&lt;build&gt;</span>
        <span class="nt">&lt;plugins&gt;</span>
            <span class="nt">&lt;plugin&gt;</span>
                <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
                <span class="nt">&lt;artifactId&gt;</span>spring-boot-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;/plugin&gt;</span>
        <span class="nt">&lt;/plugins&gt;</span>
    <span class="nt">&lt;/build&gt;</span>

<span class="nt">&lt;/project&gt;</span>
</code></pre></div>
</td></tr></table>

<p>En el panel de Maven de IntelliJ se puede consultar las librerías concretas que
se han descargado:</p>
<p><img src="imagenes/dependencias-maven.png" width="600px"/></p>
<p>En el fichero de configuración de la aplicación se definen propiedades
que configuran distintos aspectos de la misma, como la base de datos
con la que se va a trabajar o el puerto en el que debe
ejecutarse. Conforme necesitemos configurar estas propiedades iremos
añadiendo elementos al fichero.</p>
<p><strong>Fichero <code>resources/application.properties</code></strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="err">spring.application.name = demoapp</span>
</code></pre></div>
</td></tr></table>

<h3 id="controladores">Controladores<a class="headerlink" href="#controladores" title="Permanent link">&para;</a></h3>
<p>Los controladores definen el código a ejecutar como respuesta a una
petición HTTP. Son clases que se suelen colocar en el paquete
<code>controller</code> y están anotadas con <code>@Controller</code>.</p>
<p>Vemos un ejemplo en la clase <code>SaludoController</code>.</p>
<p><strong>Fichero <code>src/main/java/demoapp/controller/SaludoController.java</code></strong>:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="kn">package</span> <span class="nn">demoapp.controller</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">demoapp.service.SaludoService</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.PathVariable</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ResponseBody</span><span class="p">;</span>


<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SaludoController</span> <span class="p">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="n">SaludoService</span> <span class="n">service</span><span class="p">;</span>

    <span class="nd">@Autowired</span>
    <span class="kd">public</span> <span class="nf">SaludoController</span><span class="p">(</span><span class="n">SaludoService</span> <span class="n">service</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="na">service</span> <span class="o">=</span> <span class="n">service</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;/saludo/{nombre}&quot;</span><span class="p">)</span>
    <span class="kd">public</span> <span class="nd">@ResponseBody</span> <span class="n">String</span> <span class="nf">saludo</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s">&quot;nombre&quot;</span><span class="p">)</span> <span class="n">String</span> <span class="n">nombre</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">service</span><span class="p">.</span><span class="na">saluda</span><span class="p">(</span><span class="n">nombre</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</code></pre></div>
</td></tr></table>

<p>Los métodos en los que se definen las respuestas a las peticiones HTTP
están anotados con anotaciones en las que se indica el tipo de
petición y la URL a la que se responde.</p>
<p>Por ejemplo, en la clase anterior el método <code>saludo</code> contesta a las
peticiones dirigida a la URL <code>/saludo/Ana</code>. La cadena <code>Ana</code> en la URL
es decodificada y pasada en el parámetro <code>nombre</code> al método.</p>
<p>El método devuelve la respuesta HTTP. La anotación <code>@ResponseBody</code>
construye automáticamente esta respuesta, añadiendo como contenido de
la misma la cadena devuelta por el servicio. </p>
<p>En este caso la respuesta es:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="nt">HTTP</span><span class="o">/</span><span class="nt">1</span><span class="p">.</span><span class="nc">1</span> <span class="nt">200</span> 
<span class="nt">Content-Type</span><span class="o">:</span> <span class="nt">text</span><span class="o">/</span><span class="nt">plain</span><span class="o">;</span><span class="nt">charset</span><span class="o">=</span><span class="nt">UTF-8</span>
<span class="nt">Content-Length</span><span class="o">:</span> <span class="nt">8</span>
<span class="nt">Date</span><span class="o">:</span> <span class="nt">Mon</span><span class="o">,</span> <span class="nt">02</span> <span class="nt">Sep</span> <span class="nt">2019</span> <span class="nt">14</span><span class="p">:</span><span class="nd">59</span><span class="p">:</span><span class="nd">04</span> <span class="nt">GMT</span>

<span class="nt">Hola</span> <span class="nt">Ana</span>
</code></pre></div>
</td></tr></table>

<h3 id="clases-de-servicio">Clases de Servicio<a class="headerlink" href="#clases-de-servicio" title="Permanent link">&para;</a></h3>
<p>Es recomendable definir clases de servicio en las que se implementa la
lógica de negocio de la aplicación. Las clases <em>controller</em> llaman a las
clases servicio, que son las que realmente realizan todo el
procesamiento.</p>
<p>De esta forma se separan las responsabilidades. Las clases <em>controller</em>
se encargan de procesar las peticiones y las respuestas HTTP y las
clases de servicio son las que realmente realizan la lógica de negocio
y devuelven el contenido de las respuestas. Si en algún momento hay
que añadir una nueva capa de presentación en la que, por ejemplo, se
trabaje con objetos JSON, no será necesario cambiar la capa de
servicios, sólo añadir nuevas clases <em>controller</em>.</p>
<p>La separación de la lógica de negocio en las clases de servicio
permite también realizar tests que trabajan sobre objetos Java,
independientes de los formatos de entrada/salida manejados por los
controladores. </p>
<p><strong>Fichero <code>src/main/java/demoapp/service/SaludoService.java</code></strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="kn">package</span> <span class="nn">demoapp.service</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="p">;</span>

<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SaludoService</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">saluda</span><span class="p">(</span><span class="n">String</span> <span class="n">nombre</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s">&quot;Hola &quot;</span> <span class="o">+</span> <span class="n">nombre</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>

<h3 id="inyeccion-de-dependencias-en-spring">Inyección de dependencias en Spring<a class="headerlink" href="#inyeccion-de-dependencias-en-spring" title="Permanent link">&para;</a></h3>
<p>Spring Boot utiliza la anotación <code>@Autowired</code> para inyectar en la
variable anotada un objeto nuevo del tipo indicado. Se puede definir
la anotación en la variable o en el constructor de la clase.</p>
<p>En los ejemplos anteriores podemos comprobar estas anotaciones. En la
aplicación ejemplo se define un controlador y un servicio que devuelve
un saludo. El servicio se anota con la anotación <code>@Service</code> y esta
anotación le indica a Spring Boot que la clase que va a poder ser
inyectada.</p>
<p>En el controlador se necesita instanciar un objeto de la clase
<code>SaludoService</code> y se hace usando inyección de dependencias. En este
caso lo hacemos anotando el constructor. Spring Boot se encarga de
obtener una instancia y de inyectarla en la variable <code>service</code> que se
pasa como parámetro al constructor.</p>
<p>Mediante la inyección de dependencias el código es más flexible y es
más fácil de testear, pudiéndose definir <em>mocks</em> que sustituyen los
objetos inyectados.</p>
<p>Más información en la documentación de Spring Boot <a href="https://docs.spring.io/spring-boot/docs/2.1.16.RELEASE/reference/htmlsingle/#using-boot-spring-beans-and-dependency-injection">Spring Beans and Dependency Injection</a>.</p>
<h4>Alcance de los objetos inyectados</h4>
<p>Por defecto el alcance (<em>scope</em>) de todas las anotaciones de Spring (<code>@service</code>,
<code>@controller</code>, <code>@component</code>, etc.) es un <em>Singleton</em>. Existe una única
instancia de ese objeto que es la que se inyecta en las variables.</p>
<p>Al estar funcionando en una aplicación web, el <em>singleton</em> que hace de
controlador recibirá múltiples peticiones concurrentemente. Cada
petición irá en su propio hilo de Java, por lo que múltiples hilos
podrán estar ejecutando el mismo código del controlador. </p>
<p>Por ello hay que tener cuidado en <strong>no definir variables de instancia
mutables (con estado)</strong> dentro del controlador, porque podrían
producirse errores debidos a condiciones de carrera (un hilo modifica
la misma variable que otro está leyendo). Es conveniente que todos los
<em>beans</em> (controladores, servicios, etc.) sean objetos sin estado.</p>
<p>También es posible definir otros alcances, como <code>@RequestScope</code> o
<code>@SessionScope</code>. En el primer caso se crea una instancia nueva del
objeto para cada petición HTTP y en el segundo se crea una instancia
nueva en cada sesión HTTP.</p>
<p>Puedes encontrar más información y ejemplos en <a href="https://www.baeldung.com/spring-bean-scopes">este enlace</a>.</p>
<h3 id="plantillas-thymeleaf">Plantillas Thymeleaf<a class="headerlink" href="#plantillas-thymeleaf" title="Permanent link">&para;</a></h3>
<p>Las páginas HTML devueltas se pueden construir
utilizando un lenguaje de plantillas con el framework
<a href="https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html">Thymeleaf</a>. Las
plantillas thymeleaf son páginas HTML en las que se introducen objetos
Java pasados por los controllers.</p>
<p>Las plantillas se incluyen en el directorio <code>resources/templates</code>.</p>
<p>Por ejemplo, el siguiente fichero es una sencilla plantilla que
muestra un saludo. El objeto <code>mensaje</code> es una cadena que se pasa desde
el controller.</p>
<p><strong>Fichero <code>src/main/resources/templates/saludo.html</code></strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">xmlns:th</span><span class="o">=</span><span class="s">&quot;http://www.thymeleaf.org&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h1</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;&#39;Saludo: &#39; + ${mensaje}&quot;</span><span class="p">&gt;</span> <span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div>
</td></tr></table>

<p>El controller construye la vista devolviendo el nombre de la
plantilla. Y pasa a la plantilla los objetos a mostrar usando un
diccionario (la variable <code>model</code> que recibe como parámetro):</p>
<p><strong>Fichero <code>src/main/java/demoapp/controller/SaludoControllerPlantilla.java</code></strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="kn">package</span> <span class="nn">demoapp.controller</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">demoapp.service.SaludoService</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.PathVariable</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="p">;</span>


<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SaludoControllerPlantilla</span> <span class="p">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="n">SaludoService</span> <span class="n">service</span><span class="p">;</span>

    <span class="nd">@Autowired</span>
    <span class="kd">public</span> <span class="nf">SaludoControllerPlantilla</span><span class="p">(</span><span class="n">SaludoService</span> <span class="n">service</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="na">service</span> <span class="o">=</span> <span class="n">service</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;/saludoplantilla/{nombre}&quot;</span><span class="p">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">saludo</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s">&quot;nombre&quot;</span><span class="p">)</span> <span class="n">String</span> <span class="n">nombre</span><span class="p">,</span> 
                                                       <span class="n">Model</span> <span class="n">model</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Se añade la respuesta a la clave &#39;mensaje&#39; que se usa</span>
        <span class="c1">// en la plantilla</span>
        <span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="s">&quot;mensaje&quot;</span><span class="p">,</span> <span class="n">service</span><span class="p">.</span><span class="na">saluda</span><span class="p">(</span><span class="n">nombre</span><span class="p">));</span>
        <span class="c1">// Se llama a la plantilla &#39;saludo.html&#39;</span>
        <span class="k">return</span> <span class="s">&quot;saludo&quot;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>

<h3 id="tests">Tests<a class="headerlink" href="#tests" title="Permanent link">&para;</a></h3>
<p>En la aplicación de demostración hay varios ejemplos que muestran
posibles formas de realizar pruebas en una aplicación Spring Boot.</p>
<p>Spring Boot incluye el framework
<a href="https://assertj.github.io/doc/">AssertJ</a> que permite realizar
expresiones de prueba con un lenguaje muy expresivo.</p>
<p>Los tests se pueden ejecutar usando el comando típico de Maven:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>$ mvn <span class="nb">test</span>
</code></pre></div>
</td></tr></table>

<p>O también, usando el comando de Maven Wrapper:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>$ .mvnw <span class="nb">test</span>
</code></pre></div>
</td></tr></table>

<p>También se pueden lanzar desde el propio IntelliJ.</p>
<h4>Tests sobre clases de servicio</h4>
<p>Podemos realizar pruebas sobre la capa de servicio, obteniendo una
instancia del servicio mediante inyección de dependencias.</p>
<p>En el siguiente ejemplo se muestra cómo se prueba el método de
servicio <code>saluda</code>.</p>
<p><strong>Fichero <code>src/test/java/demoapp/ServiceTest.java</code></strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="kn">package</span> <span class="nn">demoapp</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">demoapp.service.SaludoService</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.junit.runner.RunWith</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.boot.test.context.SpringBootTest</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.test.context.junit4.SpringRunner</span><span class="p">;</span>

<span class="kn">import static</span> <span class="nn">org.assertj.core.api.Assertions.assertThat</span><span class="p">;</span>

<span class="nd">@RunWith</span><span class="p">(</span><span class="n">SpringRunner</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="nd">@SpringBootTest</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ServiceTest</span> <span class="p">{</span>

    <span class="nd">@Autowired</span>
    <span class="n">SaludoService</span> <span class="n">saludo</span><span class="p">;</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">contexLoads</span><span class="p">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>
        <span class="n">assertThat</span><span class="p">(</span><span class="n">saludo</span><span class="p">).</span><span class="na">isNotNull</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">serviceSaludo</span><span class="p">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>
        <span class="n">assertThat</span><span class="p">(</span><span class="n">saludo</span><span class="p">.</span><span class="na">saluda</span><span class="p">(</span><span class="s">&quot;Domingo&quot;</span><span class="p">)).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;Hola Domingo&quot;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>

<h4>Tests sobre capa web</h4>
<p>Es posible realizar tests sobre la capa de presentación sin lanzar
realmente el servidor web ni ejecutar realmente las peticiones
HTTP. Se obtiene por inyección de dependencias un <em>mock</em> de
la clase <code>MockMvc</code> y se usan métodos como <code>perform(get("/"))</code>.</p>
<p>En el ejemplo siguiente se comprueba que una petición <code>GET</code> a la URL
<code>/</code> devuelve un código HTTP OK (200) y una página HTML con la cadena
esperada.</p>
<p>En este test lo único que se moquea es el servidor web, y se ejecuta
el código real del servicio, del controlador y de la plantilla.</p>
<p>Se utilizan los métodos <code>andDo</code> y <code>andExpect</code> de la propia librería de
testeo de Spring Framework y el método <code>conteainsString</code> de la
librería de testeo <a href="http://hamcrest.org/JavaHamcrest/tutorial">Hamcrest</a>.</p>
<p><strong>Fichero <code>src/test/demoapp/AutoConfigureWebMockTest.java</code></strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="kn">package</span> <span class="nn">demoapp</span><span class="p">;</span>


<span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.junit.runner.RunWith</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.boot.test.context.SpringBootTest</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.test.context.junit4.SpringRunner</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.test.web.servlet.MockMvc</span><span class="p">;</span>

<span class="kn">import static</span> <span class="nn">org.hamcrest.Matchers.containsString</span><span class="p">;</span>
<span class="kn">import static</span> <span class="nn">org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get</span><span class="p">;</span>
<span class="kn">import static</span> <span class="nn">org.springframework.test.web.servlet.result.MockMvcResultHandlers.print</span><span class="p">;</span>
<span class="kn">import static</span> <span class="nn">org.springframework.test.web.servlet.result.MockMvcResultMatchers.content</span><span class="p">;</span>
<span class="kn">import static</span> <span class="nn">org.springframework.test.web.servlet.result.MockMvcResultMatchers.status</span><span class="p">;</span>

<span class="nd">@RunWith</span><span class="p">(</span><span class="n">SpringRunner</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="nd">@SpringBootTest</span>
<span class="nd">@AutoConfigureMockMvc</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AutoConfigureWebMockTest</span> <span class="p">{</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">MockMvc</span> <span class="n">mockMvc</span><span class="p">;</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">shouldReturnDefaultMessage</span><span class="p">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="na">mockMvc</span><span class="p">.</span><span class="na">perform</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">))</span>
                <span class="p">.</span><span class="na">andDo</span><span class="p">(</span><span class="n">print</span><span class="p">())</span>
                <span class="p">.</span><span class="na">andExpect</span><span class="p">(</span><span class="n">status</span><span class="p">().</span><span class="na">isOk</span><span class="p">())</span>
                <span class="p">.</span><span class="na">andExpect</span><span class="p">(</span><span class="n">content</span><span class="p">().</span><span class="na">string</span><span class="p">(</span><span class="n">containsString</span><span class="p">(</span><span class="s">&quot;Hello World&quot;</span><span class="p">)));</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>

<p>También es posible realizar un test únicamente del controlador y la
plantilla de presentación, moqueando el servicio. Se muestra en el
siguiente ejemplo.</p>
<p><strong>Fichero <code>src/test/java/WebMockTest.java</code></strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="kn">package</span> <span class="nn">demoapp</span><span class="p">;</span>


<span class="kn">import</span> <span class="nn">demoapp.controller.SaludoController</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">demoapp.service.SaludoService</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.junit.runner.RunWith</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.boot.test.autoconfigure.web.servlet.WebMvcTest</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.boot.test.mock.mockito.MockBean</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.test.context.junit4.SpringRunner</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.test.web.servlet.MockMvc</span><span class="p">;</span>

<span class="kn">import static</span> <span class="nn">org.hamcrest.Matchers.containsString</span><span class="p">;</span>
<span class="kn">import static</span> <span class="nn">org.mockito.Mockito.when</span><span class="p">;</span>
<span class="kn">import static</span> <span class="nn">org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get</span><span class="p">;</span>
<span class="kn">import static</span> <span class="nn">org.springframework.test.web.servlet.result.MockMvcResultHandlers.print</span><span class="p">;</span>
<span class="kn">import static</span> <span class="nn">org.springframework.test.web.servlet.result.MockMvcResultMatchers.content</span><span class="p">;</span>
<span class="kn">import static</span> <span class="nn">org.springframework.test.web.servlet.result.MockMvcResultMatchers.status</span><span class="p">;</span>

<span class="nd">@RunWith</span><span class="p">(</span><span class="n">SpringRunner</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="nd">@WebMvcTest</span><span class="p">(</span><span class="n">SaludoController</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">WebMockTest</span> <span class="p">{</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">MockMvc</span> <span class="n">mockMvc</span><span class="p">;</span>

    <span class="nd">@MockBean</span>
    <span class="kd">private</span> <span class="n">SaludoService</span> <span class="n">service</span><span class="p">;</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">greetingShouldReturnMessageFromService</span><span class="p">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>

        <span class="n">when</span><span class="p">(</span><span class="n">service</span><span class="p">.</span><span class="na">saluda</span><span class="p">(</span><span class="s">&quot;Domingo&quot;</span><span class="p">)).</span><span class="na">thenReturn</span><span class="p">(</span><span class="s">&quot;Hola Mock Domingo&quot;</span><span class="p">);</span>

        <span class="k">this</span><span class="p">.</span><span class="na">mockMvc</span><span class="p">.</span><span class="na">perform</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;/saludo/Domingo&quot;</span><span class="p">))</span>
                <span class="p">.</span><span class="na">andDo</span><span class="p">(</span><span class="n">print</span><span class="p">())</span>
                <span class="p">.</span><span class="na">andExpect</span><span class="p">(</span><span class="n">status</span><span class="p">().</span><span class="na">isOk</span><span class="p">())</span>
                <span class="p">.</span><span class="na">andExpect</span><span class="p">(</span><span class="n">content</span><span class="p">().</span><span class="na">string</span><span class="p">(</span><span class="n">containsString</span><span class="p">(</span><span class="s">&quot;Hola Mock Domingo&quot;</span><span class="p">)));</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>

<h4>Tests sobre la aplicación en funcionamiento</h4>
<p>Por último, también podemos realizar tests sobre la aplicación
funcionando completamente, realizando una petición al servidor web y
comprobando que se devuelve lo esperado.</p>
<p>Estos tests son los más costosos porque conllevan levantar el servidor
web y realizar completamente el procesamiento de la petición. </p>
<p><strong>Fichero <code>src/test/java/demoapp/HttpRequestTest</code></strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="kn">package</span> <span class="nn">demoapp</span><span class="p">;</span>


<span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.junit.runner.RunWith</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.boot.test.context.SpringBootTest</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.boot.test.context.SpringBootTest.WebEnvironment</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.boot.test.web.client.TestRestTemplate</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.boot.web.server.LocalServerPort</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.test.context.junit4.SpringRunner</span><span class="p">;</span>

<span class="kn">import static</span> <span class="nn">org.assertj.core.api.Assertions.assertThat</span><span class="p">;</span>

<span class="nd">@RunWith</span><span class="p">(</span><span class="n">SpringRunner</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="nd">@SpringBootTest</span><span class="p">(</span><span class="n">webEnvironment</span> <span class="o">=</span> <span class="n">WebEnvironment</span><span class="p">.</span><span class="na">RANDOM_PORT</span><span class="p">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HttpRequestTest</span> <span class="p">{</span>

    <span class="nd">@LocalServerPort</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">port</span><span class="p">;</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">TestRestTemplate</span> <span class="n">restTemplate</span><span class="p">;</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">greetingShouldReturnDefaultMessage</span><span class="p">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>
        <span class="n">assertThat</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">restTemplate</span><span class="p">.</span><span class="na">getForObject</span><span class="p">(</span><span class="s">&quot;http://localhost:&quot;</span> <span class="o">+</span> <span class="n">port</span> <span class="o">+</span> <span class="s">&quot;/&quot;</span><span class="p">,</span>
                <span class="n">String</span><span class="p">.</span><span class="na">class</span><span class="p">)).</span><span class="na">contains</span><span class="p">(</span><span class="s">&quot;Hello World&quot;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>

<h2 id="referencias">Referencias<a class="headerlink" href="#referencias" title="Permanent link">&para;</a></h2>
<ul>
<li>Getting Started Guide <a href="https://spring.io/guides/gs/spring-boot/">Building an Application with Spring Boot</a></li>
<li>Getting Started Guide <a href="https://spring.io/guides/gs/serving-web-content/">Serving Web Content with Spring MVC</a></li>
<li>Spring Boot Reference Guide 2.1.16.RELEASE
  (<a href="https://docs.spring.io/spring-boot/docs/2.1.16.RELEASE/reference/htmlsingle/">HTML</a>, <a href="https://docs.spring.io/spring-boot/docs/2.1.16.RELEASE/reference/pdf/spring-boot-reference.pdf">PDF</a>)</li>
</ul>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="practica0.html" title="Primera aplicación con Spring Boot" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Anterior
                </span>
                Primera aplicación con Spring Boot
              </span>
            </div>
          </a>
        
        
          <a href="comandos-git.html" title="Comandos Git" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Siguiente
                </span>
                Comandos Git
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org" target="_blank" rel="noopener">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.c33a9706.js"></script>
      
      <script>app.initialize({version:"1.1",url:{base:".."}})</script>
      
    
  </body>
</html>