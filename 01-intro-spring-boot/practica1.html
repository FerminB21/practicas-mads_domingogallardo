



<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copiar al portapapeles">
      
        <meta name="lang:clipboard.copied" content="Copiado al portapapeles">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No se encontraron documentos">
      
        <meta name="lang:search.result.one" content="1 documento encontrado">
      
        <meta name="lang:search.result.other" content="# documentos encontrados">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.1.1">
    
    
      
        <title>Práctica 1 - Prácticas MADS</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.3020aac5.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.224b79ff.css">
      
      
        
        
        <meta name="theme-color" content="#009688">
      
    
    
      <script src="../assets/javascripts/modernizr.01ccdecf.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="teal" data-md-color-accent="teal">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#enunciado-practica-1" tabindex="1" class="md-skip">
        Saltar a contenido
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="Prácticas MADS" class="md-header-nav__button md-logo">
          
            <img src="../imagenes/logo.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Prácticas MADS
            </span>
            <span class="md-header-nav__topic">
              Práctica 1
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Búsqueda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Teclee para comenzar búsqueda
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="Prácticas MADS" class="md-nav__button md-logo">
      
        <img src="../imagenes/logo.png" width="48" height="48">
      
    </a>
    Prácticas MADS
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      Práctica 0
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        Práctica 0
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="intro-spring-boot.html" title="Introducción a Sprign Boot para MADS" class="md-nav__link">
      Introducción a Sprign Boot para MADS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="comandos-git.html" title="Comandos Git" class="md-nav__link">
      Comandos Git
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="practica0.html" title="Práctica 0" class="md-nav__link">
      Práctica 0
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Práctica 1
      </label>
    
    <a href="practica1.html" title="Práctica 1" class="md-nav__link md-nav__link--active">
      Práctica 1
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Tabla de contenidos</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#objetivos" title="Objetivos" class="md-nav__link">
    Objetivos
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aplicacion-inicial" title="Aplicación inicial" class="md-nav__link">
    Aplicación inicial
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#metodologia-de-desarrollo" title="Metodología de desarrollo" class="md-nav__link">
    Metodología de desarrollo
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#git" title="Git" class="md-nav__link">
    Git
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flujo-de-trabajo" title="Flujo de trabajo" class="md-nav__link">
    Flujo de trabajo
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#la-aplicacion-todolist" title="La aplicación ToDoList" class="md-nav__link">
    La aplicación ToDoList
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuracion-de-la-aplicacion" title="Configuración de la aplicación" class="md-nav__link">
    Configuración de la aplicación
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gestion-de-persistencia-con-jpa" title="Gestión de persistencia con JPA" class="md-nav__link">
    Gestión de persistencia con JPA
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#servicios" title="Servicios" class="md-nav__link">
    Servicios
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#controllers" title="Controllers" class="md-nav__link">
    Controllers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vistas" title="Vistas" class="md-nav__link">
    Vistas
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pruebas-manuales-y-automaticas" title="Pruebas manuales y automáticas" class="md-nav__link">
    Pruebas manuales y automáticas
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#antes-de-empezar-la-practica" title="Antes de empezar la práctica" class="md-nav__link">
    Antes de empezar la práctica
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#desarrollo-de-la-practica" title="Desarrollo de la práctica" class="md-nav__link">
    Desarrollo de la práctica
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#version-101" title="Versión 1.0.1" class="md-nav__link">
    Versión 1.0.1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resto-de-la-practica-version-110" title="Resto de la práctica (versión 1.1.0)" class="md-nav__link">
    Resto de la práctica (versión 1.1.0)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#documentacion-entrega-y-evaluacion" title="Documentación, entrega y evaluación" class="md-nav__link">
    Documentación, entrega y evaluación
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Tabla de contenidos</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#objetivos" title="Objetivos" class="md-nav__link">
    Objetivos
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aplicacion-inicial" title="Aplicación inicial" class="md-nav__link">
    Aplicación inicial
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#metodologia-de-desarrollo" title="Metodología de desarrollo" class="md-nav__link">
    Metodología de desarrollo
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#git" title="Git" class="md-nav__link">
    Git
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flujo-de-trabajo" title="Flujo de trabajo" class="md-nav__link">
    Flujo de trabajo
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#la-aplicacion-todolist" title="La aplicación ToDoList" class="md-nav__link">
    La aplicación ToDoList
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuracion-de-la-aplicacion" title="Configuración de la aplicación" class="md-nav__link">
    Configuración de la aplicación
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gestion-de-persistencia-con-jpa" title="Gestión de persistencia con JPA" class="md-nav__link">
    Gestión de persistencia con JPA
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#servicios" title="Servicios" class="md-nav__link">
    Servicios
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#controllers" title="Controllers" class="md-nav__link">
    Controllers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vistas" title="Vistas" class="md-nav__link">
    Vistas
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pruebas-manuales-y-automaticas" title="Pruebas manuales y automáticas" class="md-nav__link">
    Pruebas manuales y automáticas
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#antes-de-empezar-la-practica" title="Antes de empezar la práctica" class="md-nav__link">
    Antes de empezar la práctica
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#desarrollo-de-la-practica" title="Desarrollo de la práctica" class="md-nav__link">
    Desarrollo de la práctica
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#version-101" title="Versión 1.0.1" class="md-nav__link">
    Versión 1.0.1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resto-de-la-practica-version-110" title="Resto de la práctica (versión 1.1.0)" class="md-nav__link">
    Resto de la práctica (versión 1.1.0)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#documentacion-entrega-y-evaluacion" title="Documentación, entrega y evaluación" class="md-nav__link">
    Documentación, entrega y evaluación
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="enunciado-practica-1">Enunciado práctica 1<a class="headerlink" href="#enunciado-practica-1" title="Permanent link">&para;</a></h1>
<h2 id="objetivos">Objetivos<a class="headerlink" href="#objetivos" title="Permanent link">&para;</a></h2>
<p>En la primera práctica de la asignatura vamos a tomar contacto con el
<em>framework</em> de desarrollo de aplicaciones web en Java <em>Spring Boot</em>,
trabajando sobre la aplicación inicial
<a href="https://github.com/domingogallardo/mads-todolist-inicial">domingogallardo/mads-todolist-inicial</a>.</p>
<p>La práctica tendrá una duración de cuatro semanas. Deberás realizarla de
forma individual, siguiendo las indicaciones que encontrarás en este
documento. Tendrás que desarrollar código y trabajar en GitHub
desarrollando <em>issues</em>, <em>pull requests</em>, <em>releases</em> y actualizando la
wiki del proyecto.</p>
<p>Igual que en la práctica 0, debes leer la <a href="intro-spring-boot.html">introducción a Spring Boot
para las prácticas de MADS</a> para entender los
conceptos fundamentales del framework.</p>
<h2 id="aplicacion-inicial">Aplicación inicial<a class="headerlink" href="#aplicacion-inicial" title="Permanent link">&para;</a></h2>
<p>La aplicación inicial es una aplicación para gestionar listas de
tareas pendientes de los usuarios de la aplicación. Se pueden registrar
y logear usuarios y los usuarios registrados pueden añadir, modificar
y borrar tareas pendientes de hacer.</p>
<p>A continuación puedes ver dos de las pantallas de la aplicación.</p>
<table>
<tr>
<td><img src="./imagenes/login.png" width="700px"/></td>
</tr>
<tr>
<td align="center"> Pantalla de login </td>
</table>

<table>
<tr>
<td><img src="./imagenes/tareas.png" width="700px"/></td>
</tr>
<tr>
<td align="center"> Pantalla con listado de tareas </td>
</table>

<p>Iremos desarrollando características adicionales de la aplicación a lo
largo de las prácticas. El nombre de la aplicación es <strong>ToDo List</strong>.</p>
<h2 id="metodologia-de-desarrollo">Metodología de desarrollo<a class="headerlink" href="#metodologia-de-desarrollo" title="Permanent link">&para;</a></h2>
<p>En cuanto a la metodología de desarrollo, en esta primera práctica
repasaremos e introduciremos el uso de:</p>
<ul>
<li><a href="https://git-scm.com">Git</a> como sistema de control de versiones que nos permitirá
  registrar paso a paso los cambios realizados en el desarrollo,
  realizando e integrando ramas de <em>features</em> en las que
  desarrollaremos pequeños incrementos que añadirán poco a poco las
  funcionalidades necesarias en la aplicación.</li>
<li><a href="https://github.com">GitHub</a> como servicio en el que publicaremos los cambios e
  integraremos las ramas usando <em>pull requests</em> (PRs). Utilizaremos un
  gran número de características de GitHub para realizar el
  seguimiento del desarrollo del proyecto: <em>issues</em>, <em>labels</em>,
  <em>milestones</em>, etc.</li>
<li>JUnit y las <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-testing.html">características de testing de Spring
  Boot</a>
  para realizar continuamente pruebas unitarias que
  validen el desarrollo.</li>
</ul>
<p>El objetivo es desarrollar software de una forma similar a cómo se
hace en cientos de proyectos punteros de desarrollo <em>open
source</em>. </p>
<p>Existen muchos proyectos que tienen un desarrollo abierto,
transparente, en GitHub. Podemos aprender de sus metodologías
estudiándolos. A continuación listamos ejemplos de repositorios en
GitHub interesantes, en los que podemos estudiar los procesos de <em>pull
requests</em>, <em>issues</em>, tableros, etc. y las dinámicas de comunicación
que utilizan.</p>
<ul>
<li><a href="https://github.com/CartoDB/cartodb">CartoDB</a>. Software español para
  representación visual de datos geográficos.</li>
<li><a href="https://github.com/vapor/vapor">Vapor</a>. Framework web en Swift.</li>
<li><a href="https://github.com/google/guice">Guice</a>. Framework de inyección de
  dependencias en Java.</li>
<li><a href="https://github.com/apple/swift-nio">swift-nio</a>. Framework asíncrono
  de entrada-salida en Swift. </li>
<li><a href="https://github.com/spring-projects/spring-boot">Spring
  Boot</a>. Framework web
  en Java.</li>
</ul>
<h3 id="git">Git<a class="headerlink" href="#git" title="Permanent link">&para;</a></h3>
<p>Git es el sistema de control de versiones más utilizado en la
actualidad. Es muy flexible, distribuido, adaptable a múltiples flujos
de trabajo e ideal para una metodología de desarrollo en
equipo. Suponemos que ya tienes cierta experiencia con su uso. Puedes
usar los siguientes enlaces para repasar su funcionamiento.</p>
<ul>
<li><a href="comandos-git.html">Resumen de comandos de Git</a>: Resumen de comandos
  principales para empezar a trabajar con Git.</li>
<li><a href="https://www.atlassian.com/git/tutorials/">Atlassian Git Tutorials</a>:
  Tutoriales muy orientados al uso de Git con gran cantidad de
  ejemplos. Es recomendable repasar los tutoriales básicos <a href="https://www.atlassian.com/git/tutorials/setting-up-a-repository">Getting
  Started</a>
  y los tutoriales
  <a href="https://www.atlassian.com/git/tutorials/syncing">Syncing</a> y <a href="https://www.atlassian.com/git/tutorials/using-branches">Using
  Branches</a> en
  el apartado <em>Collaborating</em>.</li>
<li><a href="https://git-scm.com/book/en/v2">Libro de Scott Chacon</a>: Completo
  manual con todos los detalles de todos los comandos de Git.</li>
</ul>
<p>Cuando utilicemos git es muy importante realizar unos mensajes de
<em>commit</em> claros. Un mensaje de <em>commit</em> es la forma de comunicar a los
compañeros del equipo qué cambios se han introducido en la aplicación
y ponerlos en contexto (explicar por qué se han hecho, dar algún
detalle de implementación, etc.). El post
<a href="http://chris.beams.io/posts/git-commit/">How to Write a Git Commit Message</a>
explica muy bien esto.</p>
<h3 id="flujo-de-trabajo">Flujo de trabajo<a class="headerlink" href="#flujo-de-trabajo" title="Permanent link">&para;</a></h3>
<p>Desarrollaremos la aplicación de forma iterativa, utilizando
inicialmente un flujo de trabajo Git denominado <em>feature branch</em>
(consultar la
<a href="https://guides.github.com/introduction/flow/">guía de GitHub</a>) en el
que cada característica nueva se implementa en una rama separada que
después se mezcla con la rama principal de desarrollo. Más adelante
veremos otros flujos de trabajo. Puedes ver una introducción a
distintos flujos de trabajo básicos con Git en este
<a href="https://www.atlassian.com/git/tutorials/comparing-workflows">documento de Atlassian</a>.</p>
<p>Para implementar este flujo de trabajo utilizaremos los siguientes
instrumentos de GitHub que facilitan la comunicación entre los
miembros del equipo:</p>
<ul>
<li>
<p><strong>Issues</strong> (<em>incidencias</em>): GitHub permite abrir <em>issues</em>
  (incidencias o tareas), asignarlos a personas, realizar comentarios,
  asignar etiquetas y cerrarlos cuando la implementación ha
  terminado. Consultar
  <a href="https://guides.github.com/features/issues/">Mastering Issues</a>.</p>
<p><img src="./imagenes/github-issues.png" width="500px"/></p>
<p>Definiremos distintos tipos de <em>issues</em> en función de su
propósito: <em>bug</em>, <em>technical</em>, <em>enhancement</em>. Los <em>issues</em> que
implementan una historia de usuario los etiquetaremos con el
código de la historia de usuario.</p>
<p><img src="./imagenes/labels-issues.png" width="400px"/></p>
<p>Cada <em>issue</em> se desarrollará en una rama de Git y se integrará en la
rama <em>master</em> haciendo un <em>pull request</em>.</p>
</li>
<li>
<p><strong>Pull Requests</strong>: Un <em>pull request</em> permite avisar al equipo de que
  se va a integrar en la rama principal una rama con un desarrollo
  nuevo. Cuando creamos un PR, GitHub crea una página en la que se
  pueden realizar comentarios, revisiones de código o definir
  políticas de aceptación del PR. Consultar
  <a href="https://help.github.com/articles/about-pull-requests/">About pull requests</a>.</p>
<p>Implementaremos cada <em>issue</em> en una rama separada de git y la
integraremos en la rama <code>master</code> haciendo un <em>pull
request</em>. Cuando se mezcle el PR en <code>master</code> el <em>issue</em> se
cerrará.</p>
<p><img src="./imagenes/github-pr.png" width="700px"/></p>
<p>Más adelante añadiremos otra rama de largo recorrido <code>releases</code> para
incluir en ella las <em>releases</em> del proyecto.</p>
</li>
<li>
<p><strong>Milestones</strong> y <strong>Releases</strong>: Etiquetaremos cada <em>issue</em> con el
  <em>milestone</em> en el que queremos que se lance. Para identificar el
  <em>milestone</em> usaremos el <a href="https://semver.org">versionado semántico</a>:
  MAJOR.MINOR.PATCH. </p>
<p><img src="./imagenes/github-milestones.png" width="600px"/></p>
<p>Usaremos la funcionalidad de GitHub <em>Releases</em> para etiquetar los
commits en los que queramos marcar una versión nueva del
proyecto. Podemos añadir información sobre las novedades de la
versión (normalmente serán enlaces a los <em>issues</em> y <em>pull
requests</em> de ese <em>milestone</em>).</p>
<p><img src="./imagenes/github-releases.png" width="600px"/></p>
</li>
<li>
<p><strong>Tablero de proyecto</strong>: Un tablero de proyecto nos ayudará a hacer
  un seguimiento de en qué estado se encuentra cada <em>issue</em> o PR:
  cuáles han sido implementados, cuáles faltan por asignar,
  implementar, probar, etc. Vamos a utilizar la funcionalidad propia
  de GitHub llamada <em>Projects</em>. Consultar
  <a href="https://help.github.com/articles/tracking-the-progress-of-your-work-with-project-boards/">project boards</a>.</p>
<p><img src="./imagenes/github-tablero.png" width="700px"/></p>
</li>
</ul>
<p>También utilizaremos un panel de <a href="https://trello.com/">Trello</a> para representar las
historias de usuario que se van implementando en el proyecto. </p>
<p><img src="./imagenes/historias-usuario-trello.png" width="600px"/></p>
<p>Cada historia de usuario tendrá un código numérico y podrá
implementarse con uno o más issues. En GitHub crearemos una etiqueta
por cada historia de usuario y se la asignaremos a los issues que se
usen para implementarla.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Puede parecer redundante el uso de dos tableros, uno para las
historias de usuario y otro para los <em>issues</em> y <em>PR</em>. La
justificación es que los objetivos de ambos tableros son distintos
(y los contenidos también). El tablero de GitHub será un <strong>tablero
técnico</strong> gestionado por el equipo de desarrollo. En terminología
de Scrum será el <em>sprint backlog</em>. Mientras que el
tablero Trello es un <strong>tablero de funcionalidades de usuario</strong>, que
es gestionado por el <em>product owner</em>, usado por el equipo de
desarrollo y puede ser compartido también con clientes y
gerencia. En la terminología de Scrum será el <em>product backlog</em>.</p>
</div>
<p>La documentación en Trello y en GitHub (en los <em>issues</em>, en los PRs y
en el propio <code>README.md</code> del proyecto) hay que escribirla en
<strong>Markdown</strong>, un lenguaje de marcado muy popular y sencillo de
dominar. Si no has trabajado todavía con él puedes leer estas <a href="https://help.github.com/categories/writing-on-github/">guías
de GitHub</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Existen herramientas y servicios más avanzados para gestionar
todos estos elementos del desarrollo. Por ejemplo
<a href="https://www.atlassian.com/software/jira">Jira</a>,
<a href="https://www.jetbrains.com/youtrack/">YouTrack</a>,
<a href="https://www.atlassian.com/software/confluence">Confluence</a> o
incluso <a href="https://www.atlassian.com/software/trello">Trello</a>. Pero
lo que nos ofrece GitHub es suficiente para lo que vamos a
realizar en la asignatura y tiene la ventaja de estar integrado en
una misma plataforma.</p>
</div>
<h2 id="la-aplicacion-todolist">La aplicación ToDoList<a class="headerlink" href="#la-aplicacion-todolist" title="Permanent link">&para;</a></h2>
<p>La aplicación
<a href="https://github.com/domingogallardo/mads-todolist-inicial">mads-todolist-inicial</a>
es la versión inicial de la aplicación que se va a desarrollar
durante todo el cuatrimestre en la asignatura.</p>
<p>Es una aplicación bastante más compleja que la vista en la
práctica 0. Entre otros, tiene los siguientes elementos:</p>
<ul>
<li>Gestiona distintos comandos HTTP: GET, POST, DELETE.</li>
<li>Recogida de datos en formularios HTML y validación de los datos.</li>
<li>Base de datos gestionada con JPA (<em>Java Persisence API</em>), un ORM (<em>Object Relational
  Mapping</em>) implementado por la librería Hibernate. Se utiliza una
  capa de persistencia basada en clases <em>repository</em>.</li>
<li><em>Capa de servicio</em> que proporciona la <strong>lógica de negocio</strong> a los
  controllers.</li>
<li>Las <em>clases controller</em> sólo se encargan de hacer de interfaz de la
  capa de servicio: <ul>
<li>Recoger datos de la petición HTTP,</li>
<li>tratar y validar estas entradas, </li>
<li>llamar a la clase de servicio para que se realice la acción
  requerida, y</li>
<li>convertir la respuesta obtenida de la aplicación en una vista
  que se devuelve como respuesta de la petición.</li>
</ul>
</li>
<li>En las plantillas se incluye <em>Bootstrap</em> y scripts JavaScript.</li>
<li>Las clases de servicio y de <em>repository</em> se obtienen por inyección
  de dependencias.</li>
<li>Gran número de tests que prueban la capa de servicios y la de presentación.</li>
<li>Distintos ficheros de configuración para poder arrancar la
  aplicación en distintos entornos: desarrollo y prueba.</li>
</ul>
<p>Vamos a ver con un poco más de detalle dónde puedes encontrar en el
código todos estos elementos.</p>
<h3 id="configuracion-de-la-aplicacion">Configuración de la aplicación<a class="headerlink" href="#configuracion-de-la-aplicacion" title="Permanent link">&para;</a></h3>
<p>Los distintos parámetros de la aplicación Spring Boot se configuran un
fichero de propiedades. El fichero de propiedades por defecto es
<code>application.properties</code>.</p>
<p><strong>Fichero <code>/src/main/resources/application.properties</code></strong>:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">spring</span><span class="o">.</span><span class="na">application</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">madstodolist</span>
<span class="n">spring</span><span class="o">.</span><span class="na">datasource</span><span class="o">.</span><span class="na">url</span><span class="o">=</span><span class="n">jdbc</span><span class="o">:</span><span class="n">h2</span><span class="o">:</span><span class="n">mem</span><span class="o">:</span><span class="n">dev</span>
<span class="n">spring</span><span class="o">.</span><span class="na">jpa</span><span class="o">.</span><span class="na">properties</span><span class="o">.</span><span class="na">hibernate</span><span class="o">.</span><span class="na">dialect</span> <span class="o">=</span> <span class="n">org</span><span class="o">.</span><span class="na">hibernate</span><span class="o">.</span><span class="na">dialect</span><span class="o">.</span><span class="na">H2Dialect</span>
<span class="n">spring</span><span class="o">.</span><span class="na">jpa</span><span class="o">.</span><span class="na">hibernate</span><span class="o">.</span><span class="na">ddl</span><span class="o">-</span><span class="n">auto</span><span class="o">=</span><span class="n">update</span>
<span class="n">logging</span><span class="o">.</span><span class="na">level</span><span class="o">.</span><span class="na">org</span><span class="o">.</span><span class="na">hibernate</span><span class="o">.</span><span class="na">SQL</span><span class="o">=</span><span class="n">debug</span>
<span class="n">spring</span><span class="o">.</span><span class="na">datasource</span><span class="o">.</span><span class="na">data</span><span class="o">=</span><span class="n">classpath</span><span class="o">:</span><span class="n">datos</span><span class="o">-</span><span class="n">dev</span><span class="o">.</span><span class="na">sql</span>
<span class="n">spring</span><span class="o">.</span><span class="na">datasource</span><span class="o">.</span><span class="na">initialization</span><span class="o">-</span><span class="n">mode</span><span class="o">=</span><span class="n">always</span>
</pre></div>
</td></tr></table>

<p>Se define las características de la fuente de datos con la que trabaja
la aplicación (la base de datos en memoria H2) y el fichero que
contiene los datos iniciales que se van a cargar en la base de datos
al arrancar la aplicación, el fichero <code>datos-dev.sql</code>.</p>
<p>También se define la característica de JPA
<code>spring.jpa.hibernate.ddl-auto</code> que define cómo se debe inicializar
el esquema de datos de la aplicación cuando haya un cambio en el
código fuente que define las entidades. En este caso tenemos un valor
de <code>update</code> para indicar que se el esquema de datos debe
actualizarse. En un entorno de producción el valor de esta propiedad
deberá ser <code>validate</code> para no modificar la base de datos de producción.</p>
<h4>Otras configuraciones</h4>
<p>Es posible definir otras configuraciones e indicar en el comando de
ejecución de la aplicación Spring Boot qué fichero de configuración
usar. Lo veremos en la práctica 2.</p>
<p>En esta práctica se define otra configuración en el directorio de
test, que es la que se carga cuando se lanzan los tests:</p>
<p><strong>Fichero <code>src/test/resources/application.properties</code></strong>:
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">spring</span><span class="o">.</span><span class="na">datasource</span><span class="o">.</span><span class="na">url</span><span class="o">=</span><span class="n">jdbc</span><span class="o">:</span><span class="n">h2</span><span class="o">:</span><span class="n">mem</span><span class="o">:</span><span class="n">test</span>
<span class="n">spring</span><span class="o">.</span><span class="na">jpa</span><span class="o">.</span><span class="na">properties</span><span class="o">.</span><span class="na">hibernate</span><span class="o">.</span><span class="na">dialect</span> <span class="o">=</span> <span class="n">org</span><span class="o">.</span><span class="na">hibernate</span><span class="o">.</span><span class="na">dialect</span><span class="o">.</span><span class="na">H2Dialect</span>
<span class="n">spring</span><span class="o">.</span><span class="na">jpa</span><span class="o">.</span><span class="na">hibernate</span><span class="o">.</span><span class="na">ddl</span><span class="o">-</span><span class="n">auto</span><span class="o">=</span><span class="n">create</span>
<span class="n">logging</span><span class="o">.</span><span class="na">level</span><span class="o">.</span><span class="na">org</span><span class="o">.</span><span class="na">hibernate</span><span class="o">.</span><span class="na">SQL</span><span class="o">=</span><span class="n">debug</span>
<span class="n">spring</span><span class="o">.</span><span class="na">datasource</span><span class="o">.</span><span class="na">data</span><span class="o">=</span><span class="n">classpath</span><span class="o">:</span><span class="n">datos</span><span class="o">-</span><span class="n">test</span><span class="o">.</span><span class="na">sql</span>
<span class="n">spring</span><span class="o">.</span><span class="na">datasource</span><span class="o">.</span><span class="na">initialization</span><span class="o">-</span><span class="n">mode</span><span class="o">=</span><span class="n">always</span>
</pre></div>
</td></tr></table></p>
<p>La diferencia con el fichero de configuración de desarrollo es el
nombre de la fuente de datos, el modo del
<code>spring.jpa.hibernate.ddl-auto</code>, que es <code>create</code> y el fichero de datos
iniciales que se carga al ejecutar los tests.</p>
<h3 id="gestion-de-persistencia-con-jpa">Gestión de persistencia con JPA<a class="headerlink" href="#gestion-de-persistencia-con-jpa" title="Permanent link">&para;</a></h3>
<p>Para la gestión de la persistencia de los datos en la aplicación
Spring Boot usaremos <a href="https://docs.spring.io/spring-data/jpa/docs/2.1.10.RELEASE/reference/html/">Spring Data
JPA</a>. Se
trata de un API de Spring Boot que se construye sobre JPA (<em>Java
Persistence API</em>), el ORM (<em>Object Relational Mapping</em>) estándar de
Java. La implementación de JPA que utiliza Spring Boot es Hibernate
5.3.10.</p>
<p>Spring Data JPA usa todos los conceptos de JPA y añade algunos
adicionales que facilitan aun más su utilización, como es la
definición de interfaces <code>Repository</code> con métodos CRUD estándar para
las entidades.</p>
<h4>Definición del modelo de datos</h4>
<p>El framework JPA permite definir el esquema de la base de datos usando
anotaciones en las clases denominadas de entidad. Para cada clase de
entidad se define una tabla en la base de datos, con columnas que se
mapean con sus atributos.</p>
<p>Por ejemplo, la clase <code>Usuario</code> que se lista a continuación define la
tabla <code>usuario</code> en la base de datos. Los distintos atributos (<code>login</code>,
<code>email</code>, ...) se corresponden con las columnas de la tabla.</p>
<p>El atributo <code>id</code> se corresponde con la clave primaria de la tabla. JPA
define varias estrategias para obtener esa clave primera, y se ha
escogido la estrategia <code>@GeneratedValue(strategy =
GenerationType.IDENTITY)</code> que define una columna que se autoincrementa
en cada operación de inserción de un nuevo registro en la tabla.</p>
<p>Además de los atributos, en la clase se define un constructor con los
atributos obligatorios para definir un usuario, unos <em>getters</em> y
<em>setters</em> y los métodos <code>equals</code> y <code>hashCode</code> para comparar usuarios.</p>
<p><strong>Fichero <code>src/main/java/madstodolist/model/Usuario.java</code></strong>:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">madstodolist.model</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.validation.constraints.NotNull</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Objects</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;usuarios&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Usuario</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">1L</span><span class="o">;</span>

    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">GenerationType</span><span class="o">.</span><span class="na">IDENTITY</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="o">;</span>
    <span class="nd">@NotNull</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">email</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">nombre</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">password</span><span class="o">;</span>
    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;fecha_nacimiento&quot;</span><span class="o">)</span>
    <span class="nd">@Temporal</span><span class="o">(</span><span class="n">TemporalType</span><span class="o">.</span><span class="na">DATE</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">Date</span> <span class="n">fechaNacimiento</span><span class="o">;</span>

    <span class="c1">// Definimos el tipo de fetch como EAGER para que</span>
    <span class="c1">// cualquier consulta que devuelve un usuario rellene automáticamente</span>
    <span class="c1">// toda su lista de tareas</span>
    <span class="c1">// CUIDADO!! No es recomendable hacerlo en aquellos casos en los</span>
    <span class="c1">// que la relación pueda traer a memoria una gran cantidad de entidades</span>
    <span class="nd">@OneToMany</span><span class="o">(</span><span class="n">mappedBy</span> <span class="o">=</span> <span class="s">&quot;usuario&quot;</span><span class="o">,</span> <span class="n">fetch</span> <span class="o">=</span> <span class="n">FetchType</span><span class="o">.</span><span class="na">EAGER</span><span class="o">)</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Tarea</span><span class="o">&gt;</span> <span class="n">tareas</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Tarea</span><span class="o">&gt;();</span>

    <span class="c1">// Constructor vacío necesario para JPA/Hibernate.</span>
    <span class="c1">// Lo hacemos privado para que no se pueda usar desde el código de la aplicación. Para crear un</span>
    <span class="c1">// usuario en la aplicación habrá que llamar al constructor público. Hibernate sí que lo puede usar, a pesar</span>
    <span class="c1">// de ser privado.</span>
    <span class="kd">private</span> <span class="nf">Usuario</span><span class="o">()</span> <span class="o">{}</span>

    <span class="c1">// Constructor público con los atributos obligatorios. En este caso el correo electrónico.</span>
    <span class="kd">public</span> <span class="nf">Usuario</span><span class="o">(</span><span class="n">String</span> <span class="n">email</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">email</span> <span class="o">=</span> <span class="n">email</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Long</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="n">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getEmail</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">email</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setEmail</span><span class="o">(</span><span class="n">String</span> <span class="n">email</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">email</span> <span class="o">=</span> <span class="n">email</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getNombre</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">nombre</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setNombre</span><span class="o">(</span><span class="n">String</span> <span class="n">nombre</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">nombre</span> <span class="o">=</span> <span class="n">nombre</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getPassword</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">password</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setPassword</span><span class="o">(</span><span class="n">String</span> <span class="n">password</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">password</span> <span class="o">=</span> <span class="n">password</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Date</span> <span class="nf">getFechaNacimiento</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">fechaNacimiento</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setFechaNacimiento</span><span class="o">(</span><span class="n">Date</span> <span class="n">fechaNacimiento</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">fechaNacimiento</span> <span class="o">=</span> <span class="n">fechaNacimiento</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Tarea</span><span class="o">&gt;</span> <span class="nf">getTareas</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">tareas</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setTareas</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Tarea</span><span class="o">&gt;</span> <span class="n">tareas</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">tareas</span> <span class="o">=</span> <span class="n">tareas</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="k">this</span> <span class="o">==</span> <span class="n">o</span><span class="o">)</span> <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">o</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">getClass</span><span class="o">()</span> <span class="o">!=</span> <span class="n">o</span><span class="o">.</span><span class="na">getClass</span><span class="o">())</span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="n">Usuario</span> <span class="n">usuario</span> <span class="o">=</span> <span class="o">(</span><span class="n">Usuario</span><span class="o">)</span> <span class="n">o</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">id</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">usuario</span><span class="o">.</span><span class="na">id</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span>
            <span class="c1">// Si tenemos los ID, comparamos por ID</span>
            <span class="k">return</span> <span class="n">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="n">usuario</span><span class="o">.</span><span class="na">id</span><span class="o">);</span>
        <span class="c1">// sino comparamos por campos obligatorios</span>
        <span class="k">return</span> <span class="n">email</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">usuario</span><span class="o">.</span><span class="na">email</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// Generamos un hash basado en los campos obligatorios</span>
        <span class="k">return</span> <span class="n">Objects</span><span class="o">.</span><span class="na">hash</span><span class="o">(</span><span class="n">email</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>

<p>En la definición de la entidad también se incluyen relaciones con
otras entidades. En este caso un <code>Usuario</code> tiene muchas <code>Tarea</code>s (una
relación una-a-muchos).</p>
<p>La relación uno-a-muchos se representa en la base de datos con una
clave ajena. El atributo <code>mappedBy</code> indica que la clave ajena se va a
guardar en la columna correspondiente con el atributo <code>usuario</code> de la
entidad <code>Tarea</code>.</p>
<p>La definición de <code>Tarea</code> es la siguiente:</p>
<p><strong>Fichero <code>src/main/java/madstodolist/model/Tarea.java</code></strong>:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">madstodolist.model</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.validation.constraints.NotNull</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Objects</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;tareas&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Tarea</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">1L</span><span class="o">;</span>

    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">GenerationType</span><span class="o">.</span><span class="na">IDENTITY</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="o">;</span>
    <span class="nd">@NotNull</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">titulo</span><span class="o">;</span>

    <span class="nd">@NotNull</span>
    <span class="c1">// Relación muchos-a-uno entre tareas y usuario</span>
    <span class="nd">@ManyToOne</span>
    <span class="c1">// Nombre de la columna en la BD que guarda físicamente</span>
    <span class="c1">// el ID del usuario con el que está asociado una tarea</span>
    <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;usuario_id&quot;</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">Usuario</span> <span class="n">usuario</span><span class="o">;</span>

    <span class="c1">// Constructor vacío necesario para JPA/Hibernate.</span>
    <span class="c1">// Lo hacemos privado para que no se pueda usar desde el código de la aplicación. Para crear un</span>
    <span class="c1">// usuario en la aplicación habrá que llamar al constructor público. Hibernate sí que lo puede usar, a pesar</span>
    <span class="c1">// de ser privado.</span>
    <span class="kd">private</span> <span class="nf">Tarea</span><span class="o">()</span> <span class="o">{}</span>

    <span class="c1">// Al crear una tarea la asociamos automáticamente a un</span>
    <span class="c1">// usuario. Actualizamos por tanto la lista de tareas del</span>
    <span class="c1">// usuario.</span>
    <span class="kd">public</span> <span class="nf">Tarea</span><span class="o">(</span><span class="n">Usuario</span> <span class="n">usuario</span><span class="o">,</span> <span class="n">String</span> <span class="n">titulo</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">usuario</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">titulo</span> <span class="o">=</span> <span class="n">titulo</span><span class="o">;</span>
        <span class="n">usuario</span><span class="o">.</span><span class="na">getTareas</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Long</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="n">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getTitulo</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">titulo</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setTitulo</span><span class="o">(</span><span class="n">String</span> <span class="n">titulo</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">titulo</span> <span class="o">=</span> <span class="n">titulo</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Usuario</span> <span class="nf">getUsuario</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">usuario</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUsuario</span><span class="o">(</span><span class="n">Usuario</span> <span class="n">usuario</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">usuario</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">;</span>
    <span class="o">}</span>


    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="k">this</span> <span class="o">==</span> <span class="n">o</span><span class="o">)</span> <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">o</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">getClass</span><span class="o">()</span> <span class="o">!=</span> <span class="n">o</span><span class="o">.</span><span class="na">getClass</span><span class="o">())</span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="n">Tarea</span> <span class="n">tarea</span> <span class="o">=</span> <span class="o">(</span><span class="n">Tarea</span><span class="o">)</span> <span class="n">o</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">titulo</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">tarea</span><span class="o">.</span><span class="na">titulo</span><span class="o">)</span> <span class="o">&amp;&amp;</span>
                <span class="n">usuario</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">tarea</span><span class="o">.</span><span class="na">usuario</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">Objects</span><span class="o">.</span><span class="na">hash</span><span class="o">(</span><span class="n">titulo</span><span class="o">,</span> <span class="n">usuario</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>

<h4>Recuperación <em>eager</em> y <em>lazy</em> de las colecciones</h4>
<p>En la aplicación se define la relación <em>uno-a-muchos</em> entre usuarios y
tareas: un usuario tiene muchas tareas.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Usuario</span> <span class="o">{</span>
    <span class="o">...</span>
    <span class="c1">// Definimos el tipo de fetch como EAGER para que</span>
    <span class="c1">// cualquier consulta que devuelve un usuario rellene automáticamente</span>
    <span class="c1">// toda su lista de tareas</span>
    <span class="c1">// CUIDADO!! No es recomendable hacerlo en aquellos casos en los</span>
    <span class="c1">// que la relación pueda traer a memoria una gran cantidad de entidades</span>
    <span class="nd">@OneToMany</span><span class="o">(</span><span class="n">mappedBy</span> <span class="o">=</span> <span class="s">&quot;usuario&quot;</span><span class="o">,</span> <span class="n">fetch</span> <span class="o">=</span> <span class="n">FetchType</span><span class="o">.</span><span class="na">EAGER</span><span class="o">)</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Tarea</span><span class="o">&gt;</span> <span class="n">tareas</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Tarea</span><span class="o">&gt;();</span>
    <span class="o">...</span>
<span class="o">}</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Tarea</span> <span class="o">{</span>
    <span class="o">...</span>
    <span class="c1">// Relación muchos-a-uno entre tareas y usuario</span>
    <span class="nd">@ManyToOne</span>
    <span class="c1">// Nombre de la columna en la BD que guarda físicamente</span>
    <span class="c1">// el ID del usuario con el que está asociado una tarea</span>
    <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;usuario_id&quot;</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">Usuario</span> <span class="n">usuario</span><span class="o">;</span>
    <span class="o">...</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>

<p><strong>Relaciones <em>lazy</em></strong></p>
<p>Por defecto, todas las relaciones <em>a-muchos</em> en JPA se definen de
tipo <code>LAZY</code>. </p>
<p>La característica de los atributos marcados como <em>lazy</em> en JPA es que
no se traen a memoria cuando se recupera la entidad, sino cuando se
consultan. Pero para que se traigan a memoria <strong>la conexión con la base
de datos debe estar abierta</strong>. Si ya se ha cerrado esa conexión (por
ejemplo, se ha cerrado la transacción en el método de servicio y se
quiere acceder a la una lista de tareas de un usuario devuelto por el
propio método estando en el controller) se producirá un error.</p>
<p><strong>Relaciones <em>eager</em></strong></p>
<p>Frente a la recuperación <em>lazy</em> de colecciones, también existe la
posibilidad de definir una colección como de tipo <em>EAGER</em>. En este
caso JPA se traerá siempre a memoria todos los elementos. Es el caso
de la relación entre un usuario y sus tareas.</p>
<p>En general, no es conveniente definir una relación como <em>eager</em> porque
puede provocar problemas de rendimiento en el caso en que haya muchos
elementos relacionados. </p>
<p>Pero si no hay muchos datos en la relación y los vamos a usar con
frecuencia, sí que es aconsejable usar el tipo <em>EAGER</em> para facilitar
el manejo de la entidad.</p>
<h4>Clases Repository</h4>
<p>Spring define la clase genérica <code>CrudRepository</code> que contienen métodos por
defecto para actualizar las entidades y realizar <em>queries</em> sobre
ellas. Para dejar abierta la posibilidad de cambiar la implementación,
se definen con interfaces.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">CrudRepository</span><span class="o">&lt;</span><span class="n">T</span><span class="o">,</span> <span class="n">ID</span> <span class="kd">extends</span> <span class="n">Serializable</span><span class="o">&gt;</span>  <span class="kd">extends</span> <span class="n">Repository</span><span class="o">&lt;</span><span class="n">T</span><span class="o">,</span> <span class="n">ID</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="o">&lt;</span><span class="n">S</span> <span class="kd">extends</span> <span class="n">T</span><span class="o">&gt;</span> <span class="n">S</span> <span class="nf">save</span><span class="o">(</span><span class="n">S</span> <span class="n">entity</span><span class="o">);</span>
  <span class="n">Optional</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nf">findById</span><span class="o">(</span><span class="n">ID</span> <span class="n">primaryKey</span><span class="o">);</span> 
  <span class="n">Iterable</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nf">findAll</span><span class="o">();</span>
  <span class="kt">long</span> <span class="nf">count</span><span class="o">();</span>
  <span class="kt">void</span> <span class="nf">delete</span><span class="o">(</span><span class="n">T</span> <span class="n">entity</span><span class="o">);</span>
  <span class="kt">boolean</span> <span class="nf">existsById</span><span class="o">(</span><span class="n">ID</span> <span class="n">primaryKey</span><span class="o">);</span>
  <span class="c1">// … more functionality omitted.</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>

<p>Para usar estos métodos con nuestras entidades basta con definir
interfaces que extienden esta clase genérica. Por ejemplo, la interfaz <code>TareaRepository</code>:</p>
<p><strong>Fichero <code>src/main/java/madstodolist/model/TareaRepository.java</code></strong>:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">madstodolist.model</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.data.repository.CrudRepository</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">TareaRepository</span> <span class="kd">extends</span> <span class="n">CrudRepository</span><span class="o">&lt;</span><span class="n">Tarea</span><span class="o">,</span> <span class="n">Long</span><span class="o">&gt;</span> <span class="o">{}</span>
</pre></div>
</td></tr></table>

<p>Una vez definida la interfaz, ya podemos inyectar una instancia de
<em>repository</em> y usarla en las clases de servicio. Por ejemplo,
mostramos el método de servicio que modifica el título de una tarea:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TareaService</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="n">UsuarioRepository</span> <span class="n">usuarioRepository</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">TareaRepository</span> <span class="n">tareaRepository</span><span class="o">;</span>

    <span class="nd">@Autowired</span>
    <span class="kd">public</span> <span class="nf">TareaService</span><span class="o">(</span><span class="n">UsuarioRepository</span> <span class="n">usuarioRepository</span><span class="o">,</span> <span class="n">TareaRepository</span> <span class="n">tareaRepository</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">usuarioRepository</span> <span class="o">=</span> <span class="n">usuarioRepository</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">tareaRepository</span> <span class="o">=</span> <span class="n">tareaRepository</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="o">...</span>

    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="n">Tarea</span> <span class="nf">modificaTarea</span><span class="o">(</span><span class="n">Long</span> <span class="n">idTarea</span><span class="o">,</span> <span class="n">String</span> <span class="n">nuevoTitulo</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Tarea</span> <span class="n">tarea</span> <span class="o">=</span> <span class="n">tareaRepository</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="n">idTarea</span><span class="o">).</span><span class="na">orElse</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">tarea</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">TareaServiceException</span><span class="o">(</span><span class="s">&quot;No existe tarea con id &quot;</span> <span class="o">+</span> <span class="n">idTarea</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">tarea</span><span class="o">.</span><span class="na">setTitulo</span><span class="o">(</span><span class="n">nuevoTitulo</span><span class="o">);</span>
        <span class="n">tareaRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">tarea</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">tarea</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="o">...</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>

<p>La anotación <code>@Transactional</code> hace que las acciones sobre la base de
datos se ejecuten de forma transaccional. Se abre la transacción al
del método y se cierra al final. Si sucede alguna excepción durante su
ejecución la transacción se deshace.</p>
<p>En el cuerpo del método se llama al método <code>findById</code> del repositorio
que realiza una búsqueda en la base de datos y al método <code>save</code> que actualiza el
valor de la entidad.</p>
<p>La interfaz <code>UsuarioRepository</code> es similar.</p>
<p><strong>Fichero <code>src/main/java/madstodolist/model/UsuarioRepository.java</code></strong>:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">madstodolist.model</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.data.repository.CrudRepository</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Optional</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">UsuarioRepository</span> <span class="kd">extends</span> <span class="n">CrudRepository</span><span class="o">&lt;</span><span class="n">Usuario</span><span class="o">,</span> <span class="n">Long</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="n">Optional</span><span class="o">&lt;</span><span class="n">Usuario</span><span class="o">&gt;</span> <span class="nf">findByEmail</span><span class="o">(</span><span class="n">String</span> <span class="n">s</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>

<p>La diferencia es que se añade un método <code>findByEmail</code> que hace que
Spring construya automáticamente una consulta sobre  la base de datos. Al
usar como nombre del método el nombre de la propiedad de la entidad
(<code>email</code>), Spring puede generar automáticamente la consulta.</p>
<h3 id="servicios">Servicios<a class="headerlink" href="#servicios" title="Permanent link">&para;</a></h3>
<p>La capa de servicios es la capa intermedia entre la capa de
<em>controllers</em> y la de <em>repository</em>. Es la capa que implementa toda la
lógica de negocio de la aplicación.</p>
<p>La responsabilidad principal de la capa de servicios es obtener o
crear los objetos entidad necesarios para cada funcionalidad a partir
de los datos que manda la capa <em>controller</em>, trabajar con ellos en
memoria y hacer persistentes los cambios utilizando la capa
<em>repository</em>.</p>
<p>La capa de servicios también gestionará errores y lanzará excepciones
cuando no se pueda realizar alguna funcionalidad.</p>
<p>Los servicios obtienen instancias de <em>Repository</em> usando inyección de
dependencias.</p>
<p><strong>Ventajas de utilizar una capa de servicios</strong></p>
<p>Al utilizar clases de servicios podemos aislar la lógica de negocio de
la aplicación usando métodos y objetos Java, sin preocuparnos de cómo
obtener los datos de la interfaz de usuario ni de cómo mostrar los
resultados. De esto ya se ocuparán las clases <em>controller</em>. De esta
forma, si se necesita modificar la interfaz de usuario de la
aplicación, o convertirla en un servicio REST que devuelva JSON en
lugar de HTML sólo tendremos que tocar las clases <em>controller</em>, no las
de servicio.</p>
<p>Además, al no tener ninguna dependencia con la interfaz de usuario,
estas clases de servicios también podrán ser fácilmente testeadas. La
mayoría de los tests automáticos los haremos sobre ellas.</p>
<p><strong>Fichero <code>src/main/java/madstodolist/service/UsuarioService.java</code></strong>:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">npackage</span> <span class="n">madstodolist</span><span class="o">.</span><span class="na">service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">madstodolist.model.Usuario</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">madstodolist.model.UsuarioRepository</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.slf4j.Logger</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.slf4j.LoggerFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.transaction.annotation.Transactional</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Optional</span><span class="o">;</span>

<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UsuarioService</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">enum</span> <span class="n">LoginStatus</span> <span class="o">{</span><span class="n">LOGIN_OK</span><span class="o">,</span> <span class="n">USER_NOT_FOUND</span><span class="o">,</span> <span class="n">ERROR_PASSWORD</span><span class="o">}</span>

    <span class="kd">private</span> <span class="n">UsuarioRepository</span> <span class="n">usuarioRepository</span><span class="o">;</span>

    <span class="nd">@Autowired</span>
    <span class="kd">public</span> <span class="nf">UsuarioService</span><span class="o">(</span><span class="n">UsuarioRepository</span> <span class="n">usuarioRepository</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">usuarioRepository</span> <span class="o">=</span> <span class="n">usuarioRepository</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Transactional</span><span class="o">(</span><span class="n">readOnly</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">LoginStatus</span> <span class="nf">login</span><span class="o">(</span><span class="n">String</span> <span class="n">eMail</span><span class="o">,</span> <span class="n">String</span> <span class="n">password</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Optional</span><span class="o">&lt;</span><span class="n">Usuario</span><span class="o">&gt;</span> <span class="n">usuario</span> <span class="o">=</span> <span class="n">usuarioRepository</span><span class="o">.</span><span class="na">findByEmail</span><span class="o">(</span><span class="n">eMail</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">usuario</span><span class="o">.</span><span class="na">isPresent</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">LoginStatus</span><span class="o">.</span><span class="na">USER_NOT_FOUND</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(!</span><span class="n">usuario</span><span class="o">.</span><span class="na">get</span><span class="o">().</span><span class="na">getPassword</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="n">password</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">LoginStatus</span><span class="o">.</span><span class="na">ERROR_PASSWORD</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">LoginStatus</span><span class="o">.</span><span class="na">LOGIN_OK</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="c1">// Se añade un usuario en la aplicación.</span>
    <span class="c1">// El email y password del usuario deben ser distinto de null</span>
    <span class="c1">// El email no debe estar registrado en la base de datos</span>
    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="n">Usuario</span> <span class="nf">registrar</span><span class="o">(</span><span class="n">Usuario</span> <span class="n">usuario</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Optional</span><span class="o">&lt;</span><span class="n">Usuario</span><span class="o">&gt;</span> <span class="n">usuarioBD</span> <span class="o">=</span> <span class="n">usuarioRepository</span><span class="o">.</span><span class="na">findByEmail</span><span class="o">(</span><span class="n">usuario</span><span class="o">.</span><span class="na">getEmail</span><span class="o">());</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">usuarioBD</span><span class="o">.</span><span class="na">isPresent</span><span class="o">())</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">UsuarioServiceException</span><span class="o">(</span><span class="s">&quot;El usuario &quot;</span> <span class="o">+</span> <span class="n">usuario</span><span class="o">.</span><span class="na">getEmail</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot; ya está registrado&quot;</span><span class="o">);</span>
        <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">usuario</span><span class="o">.</span><span class="na">getEmail</span><span class="o">()</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">UsuarioServiceException</span><span class="o">(</span><span class="s">&quot;El usuario no tiene email&quot;</span><span class="o">);</span>
        <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">usuario</span><span class="o">.</span><span class="na">getPassword</span><span class="o">()</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">UsuarioServiceException</span><span class="o">(</span><span class="s">&quot;El usuario no tiene password&quot;</span><span class="o">);</span>
        <span class="k">else</span> <span class="k">return</span> <span class="n">usuarioRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">usuario</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Transactional</span><span class="o">(</span><span class="n">readOnly</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">Usuario</span> <span class="nf">findByEmail</span><span class="o">(</span><span class="n">String</span> <span class="n">email</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">usuarioRepository</span><span class="o">.</span><span class="na">findByEmail</span><span class="o">(</span><span class="n">email</span><span class="o">).</span><span class="na">orElse</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Transactional</span><span class="o">(</span><span class="n">readOnly</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">Usuario</span> <span class="nf">findById</span><span class="o">(</span><span class="n">Long</span> <span class="n">usuarioId</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">usuarioRepository</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="n">usuarioId</span><span class="o">).</span><span class="na">orElse</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>

<p><strong>Fichero <code>src/main/java/madstodolist/service/UsuarioServiceException.java</code></strong>:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">madstodolist.service</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UsuarioServiceException</span> <span class="kd">extends</span> <span class="n">RuntimeException</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="nf">UsuarioServiceException</span><span class="o">(</span><span class="n">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>

<h3 id="controllers">Controllers<a class="headerlink" href="#controllers" title="Permanent link">&para;</a></h3>
<p>Las clases <em>controllers</em> son las que gestionan la interfaz de usuario
de la aplicación. Se encargan de recibir los datos de las peticiones
HTTP, llamar a la clase de servicio necesaria para procesar la lógica
de negocio y mostrar la vista con la información resultante
proporcionada por la clase de servicio.</p>
<p>En la aplicación se definen dos clases controller:</p>
<ul>
<li><code>LoginController</code>: con métodos para registrar y logear usuarios.</li>
<li><code>TareasController</code>: con métodos para crear, borrar y modificar
  tareas de un usuario.</li>
</ul>
<p>Los controllers usan clases auxiliares en las que se guardan los datos
introducidos en los formularios. Por ejemplo, la clase
<code>LoginController</code> usa las clases <code>LoginData</code> y <code>RegistroData</code>.</p>
<p><strong>Fichero <code>src/main/java/madstodolist/controller/LoginController.java</code></strong>:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">madstodolist.controller</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">madstodolist.authentication.ManagerUserSesion</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">madstodolist.model.Usuario</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">madstodolist.service.UsuarioService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.validation.BindingResult</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.GetMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ModelAttribute</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.PostMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.mvc.support.RedirectAttributes</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpSession</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.validation.Valid</span><span class="o">;</span>

<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">LoginController</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="n">UsuarioService</span> <span class="n">usuarioService</span><span class="o">;</span>

    <span class="nd">@Autowired</span>
    <span class="n">ManagerUserSesion</span> <span class="n">managerUserSesion</span><span class="o">;</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">&quot;/login&quot;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">loginForm</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&quot;loginData&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">LoginData</span><span class="o">());</span>
        <span class="k">return</span> <span class="s">&quot;formLogin&quot;</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@PostMapping</span><span class="o">(</span><span class="s">&quot;/login&quot;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">loginSubmit</span><span class="o">(</span><span class="nd">@ModelAttribute</span> <span class="n">LoginData</span> <span class="n">loginData</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span> <span class="n">RedirectAttributes</span> <span class="n">flash</span><span class="o">,</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>

        <span class="c1">// Llamada al servicio para comprobar si el login es correcto</span>
        <span class="n">UsuarioService</span><span class="o">.</span><span class="na">LoginStatus</span> <span class="n">loginStatus</span> <span class="o">=</span> <span class="n">usuarioService</span><span class="o">.</span><span class="na">login</span><span class="o">(</span><span class="n">loginData</span><span class="o">.</span><span class="na">geteMail</span><span class="o">(),</span> <span class="n">loginData</span><span class="o">.</span><span class="na">getPassword</span><span class="o">());</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">loginStatus</span> <span class="o">==</span> <span class="n">UsuarioService</span><span class="o">.</span><span class="na">LoginStatus</span><span class="o">.</span><span class="na">LOGIN_OK</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">Usuario</span> <span class="n">usuario</span> <span class="o">=</span> <span class="n">usuarioService</span><span class="o">.</span><span class="na">findByEmail</span><span class="o">(</span><span class="n">loginData</span><span class="o">.</span><span class="na">geteMail</span><span class="o">());</span>

            <span class="n">managerUserSesion</span><span class="o">.</span><span class="na">logearUsuario</span><span class="o">(</span><span class="n">session</span><span class="o">,</span> <span class="n">usuario</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>

            <span class="k">return</span> <span class="s">&quot;redirect:/usuarios/&quot;</span> <span class="o">+</span> <span class="n">usuario</span><span class="o">.</span><span class="na">getId</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot;/tareas&quot;</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">loginStatus</span> <span class="o">==</span> <span class="n">UsuarioService</span><span class="o">.</span><span class="na">LoginStatus</span><span class="o">.</span><span class="na">USER_NOT_FOUND</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&quot;error&quot;</span><span class="o">,</span> <span class="s">&quot;No existe usuario&quot;</span><span class="o">);</span>
            <span class="k">return</span> <span class="s">&quot;formLogin&quot;</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">loginStatus</span> <span class="o">==</span> <span class="n">UsuarioService</span><span class="o">.</span><span class="na">LoginStatus</span><span class="o">.</span><span class="na">ERROR_PASSWORD</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&quot;error&quot;</span><span class="o">,</span> <span class="s">&quot;Contraseña incorrecta&quot;</span><span class="o">);</span>
            <span class="k">return</span> <span class="s">&quot;formLogin&quot;</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="s">&quot;formLogin&quot;</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">&quot;/registro&quot;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">registroForm</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&quot;registroData&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">RegistroData</span><span class="o">());</span>
        <span class="k">return</span> <span class="s">&quot;formRegistro&quot;</span><span class="o">;</span>
    <span class="o">}</span>

   <span class="nd">@PostMapping</span><span class="o">(</span><span class="s">&quot;/registro&quot;</span><span class="o">)</span>
   <span class="kd">public</span> <span class="n">String</span> <span class="nf">registroSubmit</span><span class="o">(</span><span class="nd">@Valid</span> <span class="n">RegistroData</span> <span class="n">registroData</span><span class="o">,</span> <span class="n">BindingResult</span> <span class="n">result</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">hasErrors</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">return</span> <span class="s">&quot;registroForm&quot;</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">usuarioService</span><span class="o">.</span><span class="na">findByEmail</span><span class="o">(</span><span class="n">registroData</span><span class="o">.</span><span class="na">geteMail</span><span class="o">())</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&quot;registroData&quot;</span><span class="o">,</span> <span class="n">registroData</span><span class="o">);</span>
            <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&quot;error&quot;</span><span class="o">,</span> <span class="s">&quot;El usuario &quot;</span> <span class="o">+</span> <span class="n">registroData</span><span class="o">.</span><span class="na">geteMail</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot; ya existe&quot;</span><span class="o">);</span>
            <span class="k">return</span> <span class="s">&quot;formRegistro&quot;</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="n">Usuario</span> <span class="n">usuario</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Usuario</span><span class="o">(</span><span class="n">registroData</span><span class="o">.</span><span class="na">geteMail</span><span class="o">());</span>
        <span class="n">usuario</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="n">registroData</span><span class="o">.</span><span class="na">getPassword</span><span class="o">());</span>
        <span class="n">usuario</span><span class="o">.</span><span class="na">setFechaNacimiento</span><span class="o">(</span><span class="n">registroData</span><span class="o">.</span><span class="na">getFechaNacimiento</span><span class="o">());</span>
        <span class="n">usuario</span><span class="o">.</span><span class="na">setNombre</span><span class="o">(</span><span class="n">registroData</span><span class="o">.</span><span class="na">getNombre</span><span class="o">());</span>

        <span class="n">usuarioService</span><span class="o">.</span><span class="na">registrar</span><span class="o">(</span><span class="n">usuario</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&quot;redirect:/login&quot;</span><span class="o">;</span>
   <span class="o">}</span>

   <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">&quot;/logout&quot;</span><span class="o">)</span>
   <span class="kd">public</span> <span class="n">String</span> <span class="nf">logout</span><span class="o">(</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&quot;idUsuarioLogeado&quot;</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&quot;redirect:/login&quot;</span><span class="o">;</span>
   <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>

<p><strong>Fichero <code>src/main/java/madstodolist/controller/LoginData.java</code></strong>:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">madstodolist.controller</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">LoginData</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">eMail</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">password</span><span class="o">;</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">geteMail</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">eMail</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">seteMail</span><span class="o">(</span><span class="n">String</span> <span class="n">eMail</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">eMail</span> <span class="o">=</span> <span class="n">eMail</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getPassword</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">password</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setPassword</span><span class="o">(</span><span class="n">String</span> <span class="n">password</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">password</span> <span class="o">=</span> <span class="n">password</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>

<h4>Peticiones y rutas</h4>
<p>Las rutas que se definen en los controllers para realizar las acciones
de la aplicación son:</p>
<p><strong><code>LoginController</code></strong></p>
<ul>
<li><code>GET /login</code>: devuelve el formulario de login</li>
<li><code>POST /login</code>: realiza el login</li>
<li><code>GET /registro</code>: devuelve el formulario de registro</li>
<li><code>POST /registro</code>: realiza el registro</li>
<li><code>GET /logout</code>: realiza la salida del usuario de la aplicación</li>
</ul>
<p><strong><code>TareaController</code></strong></p>
<ul>
<li><code>GET /usuarios/{id}/tareas/nueva</code>: devuelve el formulario para
añadir una tarea al usuario con identificador <code>{id}</code></li>
<li><code>POST /usuarios/{id}/tareas/nueva</code>: añade una tarea nueva a un usuario</li>
<li><code>GET /usuarios/{id}/tareas</code>: devuelve el listado de tareas de un usuario</li>
<li><code>GET /tareas/{id}/editar"</code>: devuelve el formulario para editar una tarea</li>
<li><code>POST /tareas/{id}/editar</code>: añade una tarea modificada </li>
<li><code>DELETE /tareas/{id}</code>: realiza el borrado de una tarea</li>
</ul>
<h3 id="vistas">Vistas<a class="headerlink" href="#vistas" title="Permanent link">&para;</a></h3>
<p>Todas las vistas de la aplicación comparten la misma cabecera y pie de
página. Para centralizar estos elementos se usa la característica de
fragmentos de Thymeleaf. Los fragmentos comunes se definen en el
fichero <code>fragments.html</code>.</p>
<p><strong>Fichero <code>src/main/resources/templates/fragments.html</code></strong>:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">xmlns:th</span><span class="o">=</span><span class="s">&quot;http://www.thymeleaf.org&quot;</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">head</span> <span class="na">th:fragment</span><span class="o">=</span><span class="s">&quot;head (titulo)&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;${titulo}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">th:href</span><span class="o">=</span><span class="s">&quot;@{/css/bootstrap.min.css}&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:fragment</span><span class="o">=</span><span class="s">&quot;javascript&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">th:src</span><span class="o">=</span><span class="s">&quot;@{/js/jquery.min.js}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">th:src</span><span class="o">=</span><span class="s">&quot;@{/js/popper.min.js.css}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">th:src</span><span class="o">=</span><span class="s">&quot;@{/js/bootstrap.min.js}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">span</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;${scripts}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
/html&gt;
</pre></div>
</td></tr></table>

<p>Vemos que las vistas usan el framework CSS <em>Bootstrap</em> y varias
librerías JavaScript. Ambos se encuentran en el directorio
<code>src/main/resources/static/</code>, el directorio por defecto en el que se
guardan los recursos estáticos de una aplicación Spring Boot.</p>
<p>La vista principal es el listado de tareas.</p>
<p><strong>Fichero <code>src/main/resources/templates/listaTareas.html</code></strong>:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">xmlns:th</span><span class="o">=</span><span class="s">&quot;http://www.thymeleaf.org&quot;</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">head</span> <span class="na">th:replace</span><span class="o">=</span><span class="s">&quot;fragments :: head (titulo=&#39;Login&#39;)&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;container-fluid&quot;</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;row mt-3&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">h2</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;&#39;Listado de tareas de &#39; + ${usuario.nombre}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;row mt-3&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">table</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;table table-striped&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">thead</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>Id<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>Tarea<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>Acción<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">thead</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">tbody</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">tr</span> <span class="na">th:each</span><span class="o">=</span><span class="s">&quot;tarea: ${tareas}&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;${tarea.id}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;${tarea.titulo}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-primary btn-xs&quot;</span> <span class="na">th:href</span><span class="o">=</span><span class="s">&quot;@{/tareas/{id}/editar(id=${tarea.id})}&quot;</span><span class="p">/&gt;</span>editar<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-danger btn-xs&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;#&quot;</span> <span class="na">onmouseover</span><span class="o">=</span><span class="s">&quot;&quot;</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;cursor: pointer;&quot;</span>
                           <span class="na">th:onclick</span><span class="o">=</span><span class="s">&quot;&#39;del(\&#39;/tareas/&#39; + ${tarea.id} + &#39;\&#39;)&#39;&quot;</span><span class="p">&gt;</span>borrar<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">tbody</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-primary&quot;</span> <span class="na">th:href</span><span class="o">=</span><span class="s">&quot;@{/usuarios/{id}/tareas/nueva(id=${usuario.id})}&quot;</span><span class="p">&gt;</span> Nueva tarea<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-link&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/logout&quot;</span><span class="p">&gt;</span>Salir<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;row mt-2&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;alert alert-success alert-dismissible fade show&quot;</span> <span class="na">role</span><span class="o">=</span><span class="s">&quot;alert&quot;</span> <span class="na">th:if</span><span class="o">=</span><span class="s">&quot;${!#strings.isEmpty(mensaje)}&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;${mensaje}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;button&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;close&quot;</span> <span class="na">data-dismiss</span><span class="o">=</span><span class="s">&quot;alert&quot;</span> <span class="na">aria-label</span><span class="o">=</span><span class="s">&quot;Close&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">span</span> <span class="na">aria-hidden</span><span class="o">=</span><span class="s">&quot;true&quot;</span><span class="p">&gt;</span><span class="ni">&amp;times;</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>


<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:replace</span><span class="o">=</span><span class="s">&quot;fragments::javascript&quot;</span><span class="p">/&gt;</span>

<span class="c">&lt;!-- Ejemplo de uso de Ajax para lanzar una petición DELETE y borrar una tarea --&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/javascript&quot;</span><span class="p">&gt;</span>
    <span class="kd">function</span> <span class="nx">del</span><span class="p">(</span><span class="nx">urlBorrar</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">confirm</span><span class="p">(</span><span class="s1">&#39;¿Estás seguro/a de que quieres borrar la tarea?&#39;</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
                <span class="nx">url</span><span class="o">:</span> <span class="nx">urlBorrar</span><span class="p">,</span>
                <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;DELETE&#39;</span><span class="p">,</span>
                <span class="nx">success</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
                    <span class="c1">//refresh the page</span>
                    <span class="nx">location</span><span class="p">.</span><span class="nx">reload</span><span class="p">();</span>
                <span class="p">}</span>
            <span class="p">});</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</td></tr></table>

<ul>
<li>La plantilla recibe una lista de tareas, un usuario y un mensaje
(consultar en el controller <code>TareasController</code> cómo se obtienen esos
datos). </li>
<li>Define un script JavaScript en el que se realiza una petición
  <code>DELETE</code> a la URL que se le pasa como parámetro (se utilizará para
  lanzar la acción de borrar una tarea).</li>
<li>Utiliza una instrucción de iteración sobre la lista de tares para
  construir los elementos de la tabla de tareas.</li>
<li>En las acciones de añadir y editar tareas se construyen las URLs a
  las que hacer la petición usando el identificador de la tarea.</li>
</ul>
<h4>Autenticación y control de acceso</h4>
<p>En la aplicación se realiza una autenticación y un control de acceso
muy sencillo usando la sesión HTTP. Esta sesión se implementa en
Spring Boot con una cookie que se pasa desde el navegador hasta el
servidor en cada petición.</p>
<p>El manejo de la sesión es muy sencillo: es un diccionario en el que
podemos añadir datos. En el servidor podemos obtener los datos de la
sesión consultando el diccionario.</p>
<p>La implementación de la autenticación y del control de acceso se
realiza con en la clase <code>ManagerUserSesion</code>:</p>
<p><strong>Fichero <code>src/main/java/madstodolist/authentication/ManagerUserSesion.java</code></strong>:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">madstodolist.authentication</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Component</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpSession</span><span class="o">;</span>

<span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ManagerUserSesion</span> <span class="o">{</span>

    <span class="c1">// Añadimos el id de usuario en la sesión HTTP para hacer</span>
    <span class="c1">// una autorización sencilla. En los métodos de controllers</span>
    <span class="c1">// comprobamos si el id del usuario logeado coincide con el obtenido</span>
    <span class="c1">// desde la URL</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">logearUsuario</span><span class="o">(</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">,</span> <span class="n">Long</span> <span class="n">idUsuario</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&quot;idUsuarioLogeado&quot;</span><span class="o">,</span> <span class="n">idUsuario</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="c1">// Si el usuario no está logeado se lanza una excepción</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">comprobarUsuarioLogeado</span><span class="o">(</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">,</span> <span class="n">Long</span> <span class="n">idUsuario</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Long</span> <span class="n">idUsuarioLogeado</span> <span class="o">=</span> <span class="o">(</span><span class="n">Long</span><span class="o">)</span> <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&quot;idUsuarioLogeado&quot;</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">idUsuario</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">idUsuarioLogeado</span><span class="o">))</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">UsuarioNoLogeadoException</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>

<p>Se implementa como un componente Spring con la anotación <code>@Component</code>,
lo inyectamos en los controllers y lo mockeamos en los tests de los controllers.</p>
<h3 id="pruebas-manuales-y-automaticas">Pruebas manuales y automáticas<a class="headerlink" href="#pruebas-manuales-y-automaticas" title="Permanent link">&para;</a></h3>
<p>Durante el desarrollo de la práctica será necesario realizar <strong>pruebas
manuales</strong> de la aplicación, introducir datos en sus pantallas y
comprobar que los cambios que hemos añadido funcionan correctamente.</p>
<p>Para estas pruebas manuales recomendamos utilizar la configuración de
ejecución trabajando sobre una base de datos con valores
iniciales. Estos valores iniciales se cargan en la aplicación al
comenzar.</p>
<p><strong>Fichero <code>src/main/resources/datos-dev.sql</code></strong>:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">usuarios</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">nombre</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">fecha_nacimiento</span><span class="p">)</span> <span class="k">VALUES</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;domingo@ua&#39;</span><span class="p">,</span> <span class="s1">&#39;Domingo Gallardo&#39;</span><span class="p">,</span> <span class="s1">&#39;123&#39;</span><span class="p">,</span> <span class="s1">&#39;2001-02-10&#39;</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">tareas</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">titulo</span><span class="p">,</span> <span class="n">usuario_id</span><span class="p">)</span> <span class="k">VALUES</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;Lavar coche&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">tareas</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">titulo</span><span class="p">,</span> <span class="n">usuario_id</span><span class="p">)</span> <span class="k">VALUES</span><span class="p">(</span><span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="s1">&#39;Renovar DNI&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<p>Para los tests automáticos se cargan los datos definidos en el fichero
<code>datos-tests.sql</code>.</p>
<p><strong>Fichero <code>src/test/resources/datos-test.sql</code></strong>:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">usuarios</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">nombre</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">fecha_nacimiento</span><span class="p">)</span> <span class="k">VALUES</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;ana.garcia@gmail.com&#39;</span><span class="p">,</span> <span class="s1">&#39;Ana García&#39;</span><span class="p">,</span> <span class="s1">&#39;12345678&#39;</span><span class="p">,</span> <span class="s1">&#39;2001-02-10&#39;</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">tareas</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">titulo</span><span class="p">,</span> <span class="n">usuario_id</span><span class="p">)</span> <span class="k">VALUES</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;Lavar coche&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">tareas</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">titulo</span><span class="p">,</span> <span class="n">usuario_id</span><span class="p">)</span> <span class="k">VALUES</span><span class="p">(</span><span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="s1">&#39;Renovar DNI&#39;</span><span class="p">,</span>
<span class="s1">&#39;1&#39;</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<p>Se realizan tests automáticos sobre las entidades y repository:</p>
<ul>
<li><code>TareaTest.java</code></li>
<li><code>UsuarioTest.java</code>:</li>
</ul>
<p>También sobre la capa de servicio: </p>
<ul>
<li><code>TareaServiceTest.java</code></li>
<li><code>UsuarioServiceTest.java</code></li>
</ul>
<p>Y sobre las vistas:</p>
<ul>
<li><code>UsuarioWebTest.java</code></li>
<li><code>TareaWebTest.java</code></li>
</ul>
<p>En los tests sobre repository se debe usar la anotación
<code>@Transactional</code> para definir el contexto transaccional en el que se
realiza la llamada a las acciones sobre la base de datos.</p>
<p>En los tests sobre las vistas se <em>mockean</em> los servicios para que
devuelvan los datos que nos interesan.</p>
<p>Hay que ser cuidadoso al hacer pruebas que afectan a la base de datos,
porque podemos insertar o modificar datos que se comprueban en otros
tests. Tenemos que tener cuidado en que cada test sea independiente de
los demás.</p>
<h2 id="antes-de-empezar-la-practica">Antes de empezar la práctica<a class="headerlink" href="#antes-de-empezar-la-practica" title="Permanent link">&para;</a></h2>
<ol>
<li>Una vez logeado en GitHub, copia el enlace con una invitación que
   compartiremos en el foro de Moodle. Con esa invitación se creará
   automáticamente el repositorio <code>todolist-2019-&lt;usuario&gt;</code> en la
   organización <a href="https://github.com/mads-ua">mads-ua</a>. Al igual que el
   repositorio de la práctica 0. Es un repositorio privado al que
   tienes acceso tú y el profesor. Contiene el código inicial de un
   proyecto base (es una copia del repositorio
   <a href="https://github.com/domingogallardo/mads-todolist-inicial">domingogallardo/mads-todolist-inicial</a>)
   en la que se han comprimido todos los commits en uno.</li>
</ol>
<p>Al igual que en la práctica 0 es importante que tengas en cuenta
  que el repositorio recién creado no reside en tu cuenta, sino en
  la organización <code>mads-ua</code>. Puedes acceder a él desde el
   <em>dashboard</em> de GitHub que aparece cuando te logeas:</p>
<ol start="2">
<li>
<p>Descarga el proyecto y comprueba que se compila y ejecuta
   correctamente:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>$ git clone https://github.com/mads-ua/todolist-2019-usuario.git
$ <span class="nb">cd</span> todolist-2019-usuario
$ mvn spring-boot:run
</pre></div>
</td></tr></table>

<p>Comprueba que la aplicación está funcionando en
<a href="http://localhost:8080/login">http://localhost:8080/login</a> en la máquina host.</p>
<p><img src="./imagenes/login.png" width="600px"/></p>
<p>Para la aplicación haciendo CTR+C en el terminal.</p>
</li>
<li>
<p>Importa el proyecto en IntelliJ para trabajar, ejecutar los tests y
   lanzar la aplicación desde este entorno.</p>
</li>
<li>
<p>Es posible examinar el esquema de la base de datos y los datos
   accediendo a la base de datos H2 en memoria añadiendo las
   siguientes preferencias:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">spring</span><span class="o">.</span><span class="na">h2</span><span class="o">.</span><span class="na">console</span><span class="o">.</span><span class="na">enabled</span><span class="o">=</span><span class="kc">true</span>
<span class="n">spring</span><span class="o">.</span><span class="na">h2</span><span class="o">.</span><span class="na">console</span><span class="o">.</span><span class="na">path</span><span class="o">=/</span><span class="n">h2</span><span class="o">-</span><span class="n">console</span>
</pre></div>
</td></tr></table>

<p>Una vez lanzada la aplicación, podemos acceder a
<a href="http://localhost:8080/h2-console">http://localhost:8080/h2-console</a> introduciendo como <code>JDBC URL</code>
la dirección de la fuente de datos <code>jdbc:h2:mem:dev</code> y como
<code>User name</code> la cadena <code>sa</code></p>
<p><img src="./imagenes/h2-console-login.png" width="400px"/></p>
<p>Y examinar tablas en concreto:</p>
<p><img src="./imagenes/h2-console-tablas.png" width="600px"/></p>
</li>
<li>
<p>Crea un tablero Trello público llamado <code>ToDoList MADS</code>. Va a servir
   como <em>backlog</em> de las historias de usuario que debes realizar en
   la práctica.  Añade en él 3 columnas, tal y se explica en el
   apartado anterior de metodología de desarrollo.</p>
</li>
</ol>
<p>Añade el enlace en la descripción del repositorio GitHub, para que
   el profesor pueda acceder a consultar el estado del proyecto.</p>
<p>Un ejemplo de tablero es el <a href="https://trello.com/b/5zWOT6uO/todolist-inicial">Trello del proyecto mads-todolist-inicial</a>.</p>
<h2 id="desarrollo-de-la-practica">Desarrollo de la práctica<a class="headerlink" href="#desarrollo-de-la-practica" title="Permanent link">&para;</a></h2>
<p>En esta primera práctica vamos a desarrollar las siguientes historias de usuario o <em>features</em>:</p>
<ol>
<li>Página <em>Acerca de</em></li>
<li>Barra de menú</li>
<li>Página listado de usuarios</li>
<li>Página descripción de usuario</li>
<li>Usuario administrador (opcional)</li>
<li>Protección del listado y descripción de usuarios (opcional)</li>
<li>Bloqueo de usuarios por el usuario administrador (opcional)</li>
</ol>
<p>La práctica va a consistir en la realización en tu proyecto de todos
los elementos necesarios para implementar estas <em>features</em> : tablero Trello,
<em>issues</em>, <em>pull requests</em> (con sus <em>commits</em> en los que se desarrolla paso a paso
cada <em>issue</em>) y tablero del proyecto. </p>
<p>Haremos paso a paso la historia de usuario 1, creando la primera
versión 1.0.1 de la aplicación. Las siguientes características las
deberás desarrollar tu mismo y entregar la versión 1.1.0.</p>
<h3 id="version-101">Versión 1.0.1<a class="headerlink" href="#version-101" title="Permanent link">&para;</a></h3>
<p>La versión 1.0.1 será la versión inicial de la
aplicación. Desarrollaremos en esta versión la primera característica:
<strong>Página <em>Acerca de</em></strong>.</p>
<h4>Tablero Trello</h4>
<p>Utilizaremos el tablero Trello para documentar las características a
desarrollar en la aplicación. Deberá haber una tarjeta para cada
característica. Cada característica deberá tener un número y un título.</p>
<p><img src="imagenes/trello-version-1.png" width="600px"/></p>
<p>Añade la descripción de la característica <strong>Página <em>Acerca de</em></strong>:</p>
<p><img src="imagenes/trello-acerca-de.png" width="700px"/></p>
<p>Cuando empecemos a trabajar en la historia de usuario moveremos la
tarjeta a <em>En marcha</em> y cuando la hayamos terminado de testear e
integrar en la rama principal la moveremos a <em>Terminadas</em>.</p>
<h4>Tablero de GitHub</h4>
<p>Configura el tablero de GitHub, poniendo como nombre <code>ToDoList</code> y
seleccionando como plantilla <code>Automated kanban</code>. Elimina las tarjetas
en la columna <code>To do</code> y añade la columna <code>In pull request</code> entre <code>In
progress</code> y <code>Done</code>.</p>
<p><img src="./imagenes/project-practica.png" width="900px"></p>
<p>En las columnas deberán aparecer los <em>issues</em> y <em>pull requests</em> del
proyecto. GitHub permite automatizar el movimiento de las tarjetas de
una columna a otra. A continuación mostramos la configuración que
usaremos:</p>
<p><img src="./imagenes/projecto-practica-automation.png" width="900px"/></p>
<p>Deberemos mover manualmente las tarjetas en algún caso, porque GitHub
no podrá detectar las condiciones. En resumen, las condiciones de las
fichas que habrá en cada columna son las siguientes:</p>
<ul>
<li>Columna <code>To do</code>: Nuevos <em>issues</em> añadidos al proyecto. Cuando
  añadimos el proyecto al <em>issue</em> (en la página del <em>issue</em>) GitHub
  lo coloca automáticamente en esta columna.</li>
<li>Columna <code>In progress</code>: <em>Issues</em> que se han comenzado a implementar
  (se ha creado una rama su desarrollo). Manual.</li>
<li>Columna <code>In pull request</code>: <em>Pull request</em> creados. Cuando añadimos
  el proyecto al <em>pull request</em> (en la página del <em>pull request</em>)
  GitHub lo coloca automáticamente en esta columna. <strong>Archivaremos el
  <em>issue</em></strong> implementado por el <em>pull request</em> manualmente.</li>
<li>Columna <code>Done</code>: <em>Pull requests</em> cerrados. GitHub lo detecta automáticamente.</li>
</ul>
<h4>Issues</h4>
<p>Añade las etiquetas que vamos a usar inicialmente.</p>
<p><img src="./imagenes/labels-practica.png" width="400px"/></p>
<p>Crea el primer <em>issue</em>, correspondiente a la <em>feature</em> a desarrollar
<strong>Página <em>Acerca de</em></strong>. Crea el <em>milestone</em> 1.0.1. y añade el issue a
él.</p>
<p><img src="./imagenes/issue-acerca-de-listado.png" width="500px"/></p>
<p><img src="./imagenes/issue-acerca-de-detalle.png" width="600px"/></p>
<p>Añade el <em>issue</em> al proyecto (desde la página del <em>issue</em>) y
automáticamente se añadirá en la columna <code>To do</code>.</p>
<h4>Desarrollo</h4>
<p>Para desarrollar el <em>issue</em> abriremos una rama en Git, realizaremos
commits sobre ella hasta estar terminado y después crearemos un <em>pull
request</em> en GitHub para realizar la integración con la rama <code>master</code>.</p>
<p>Mueve en el tablero la tarjeta con el <em>issue</em> a la columna <code>In
progress</code>.</p>
<p><img src="./imagenes/in-progress-issue-1.png" width="500px" /></p>
<p>Empezamos el desarrollo importando el proyecto en IntelliJ y abriendo
un terminal para trabajar con Git:</p>
<p><img src="./imagenes/intellij-practica.png" width="700px"/></p>
<p>En el terminal escribimos los comandos para crear la rama en la que
desarrollaremos la <em>feature</em> y subirla:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>(master) $ git checkout -b acerca-de
(acerca-de) $ git push -u origin acerca-de
</pre></div>
</td></tr></table>

<h5>Primer commit</h5>
<p>Hacemos un primer commit.</p>
<p>Cambia en <code>pom.xml</code> el nombre del proyecto a <code>mads-todolist-&lt;tu-nombre&gt;</code> y
la versión a <code>1.0.1-SNAPSHOT</code>. El sufijo <code>SNAPSHOT</code> indica <em>en
desarrollo</em>. Cuando hagamos el <em>release</em> de la versión 1.0.1
eliminaremos el sufijo.</p>
<p>Realiza el commit y súbelo a GitHub:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>(acerca-de) $ git status (comprobamos los ficheros que han cambiado)
(acerca-de) $ git add pom.xml
(acerca-de) $ git status (comprobamos que está listo para añadirse en el commit)
(acerca-de) $ git commit -m &quot;Cambiado el nombre del proyecto y empezamos versión 1.0.1&quot;
(acerca-de) $ git push
</pre></div>
</td></tr></table>

<p>Consulta en GitHub que el <em>commit</em> se ha subido en GitHub:</p>
<p><img src="./imagenes/commit-practica-github.png" width="500px"/></p>
<p>De esta forma habrás comprobado que tienes permiso de escritura en
el repositorio y que ya puedes comenzar a realizar la práctica.</p>
<h5>Segundo commit</h5>
<p>En el segundo commit incluiremos el desarrollo de los elementos
necesarios para la página <em>acerca de</em>:</p>
<ul>
<li>Acción en controller</li>
<li>Vista</li>
</ul>
<p>Añade los siguientes ficheros:</p>
<p>**Controller <code>HomeController.java</code>:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">madstodolist.controller</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.GetMapping</span><span class="o">;</span>

<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HomeController</span> <span class="o">{</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">&quot;/&quot;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">home</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&quot;redirect:/login&quot;</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">&quot;/about&quot;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">loginForm</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&quot;about&quot;</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></div>
</td></tr></table>

<p><strong>Vista <code>about.html</code></strong>:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">xmlns:th</span><span class="o">=</span><span class="s">&quot;http://www.thymeleaf.org&quot;</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">head</span> <span class="na">th:replace</span><span class="o">=</span><span class="s">&quot;fragments :: head (titulo=&#39;Login&#39;)&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;container-fluid&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;container-fluid&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>ToDo List<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>Desarrollada por Domingo Gallardo<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>Versión 1.0.0 (en desarrollo)<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>Fecha de release: pendiente de release<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:replace</span><span class="o">=</span><span class="s">&quot;fragments::javascript&quot;</span><span class="p">/&gt;</span>

<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</td></tr></table>

<p>Prueba la página accediendo a la url <a href="http://localhost:9000/about">http://localhost:9000/about</a>.</p>
<p><img src="./imagenes/pagina-acerca-de.png" width="400px"/></p>
<p>Por último, confirma el commit en la rama y súbelo a GitHub. En el
panel <code>Git</code>:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>(acerca-de) $ git add .
(acerca-de) $ git status (comprueba que se han añadido los ficheros)
(acerca-de) $ git commit -m &quot;Añadida vista y controller &#39;about&#39;&quot;
(acerca-de) $ git push
</pre></div>
</td></tr></table>

<h5>Tercer commit</h5>
<p>En el tercer commit pondremos un enlace a la página <em>acerca de</em> en la página de
login de la aplicación.</p>
<p>Realiza el siguiente cambio:</p>
<p><strong>Fichero <code>formLogin.html</code></strong>:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>                         &lt;a class=&quot;btn btn-link&quot; href=&quot;/registro&quot;&gt;Ir a registro&lt;/a&gt;
<span class="gi">+                        &lt;a class=&quot;btn btn-link&quot; href=&quot;/about&quot;&gt;Acerca de&lt;/a&gt;</span>
<span class="gi">+                    &lt;/div&gt;</span>
             &lt;/form&gt;
</pre></div>
</td></tr></table>

<p>Prueba que funciona correctamente, haz el commit y súbelo a GitHub:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>(acerca-de) $ git commit -am &quot;Añadido enlace a página &#39;about&#39; en página &#39;login&#39;&quot;
(acerca-de) $ git push
</pre></div>
</td></tr></table>

<h4>Pull request</h4>
<p>Una vez terminada la implementación de la <em>feature</em> en la rama,
creamos un <em>pull request</em> en GitHub para indicar que estamos listos
para mezclar la rama con la <em>feature</em> con la rama principal de
desarrollo (<em>master</em>).</p>
<p>Más adelante añadiremos al <em>pull request</em> una comprobación automática
de las pruebas y una revisión de código por parte de compañeros del
equipo. Por ahora haremos nosotros ambas tareas.</p>
<p>Vamos a verlo paso a paso.</p>
<p>Empezamos por mezclar la rama de forma local con <code>master</code>, antes de
hacer el <em>pull request</em> en GitHub, para probar que no se ha roto nada
(todos los tests deben seguir pasando) y que los tests que hemos
añadido también funcionan correctamente (en este caso no hemos añadido
ninguno).</p>
<p>En el terminal:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>(acerca-de) $ git checkout master
(master) $ git merge acerca-de 
    Fast-forward
      pom.xml                                                   |  4 ++--
      src/main/java/madstodolist/controller/HomeController.java | 20 ++++++++++++++++++++
      src/main/resources/templates/about.html                   | 22 ++++++++++++++++++++++
      src/main/resources/templates/formLogin.html               |  2 ++
      4 files changed, 46 insertions(+), 2 deletions(-)
</pre></div>
</td></tr></table>

<p>Lanzamos los tests (lo podemos hacer en el terminal o en IntelliJ):</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>(master) $ mvn test
...
[INFO] 
[INFO] Tests run: 31, Failures: 0, Errors: 0, Skipped: 0
[INFO] 
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time:  21.879 s
</pre></div>
</td></tr></table>

<p>Una vez que hemos comprobado que todo funciona bien, deshacemos el
merge que acabamos de realizar en la rama <code>master</code>, ya que
actualizaremos después la rama con el resultado del <em>pull request</em> en
GitHub:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>(master) $ git log --oneline (muestra la historia de commits y las ramas)
(master) $ git reset --hard origin/master
    HEAD is now at 51ebf62 Initial commit
(master) $ git checkout acerca-de 
    Switched to branch &#39;acerca-de&#39;
    Your branch is up to date with &#39;origin/acerca-de&#39;.
</pre></div>
</td></tr></table>

<p>Ya podemos crear el <em>pull request</em> en GitHub. </p>
<p>Accede a la rama y comprueba que están todos los cambios pulsando
<code>Compare</code>. </p>
<p><img src="./imagenes/rama-acerca-de.png" width="700px"/></p>
<p>Aparecerá la siguiente página, con la información de los cambios que
introducen todos los commits de la rama:</p>
<p><img src="./imagenes/compara-cambios-pr.png" width="700px"/></p>
<p>Pulsa después el botón <em>Create pull request</em> para crear el <em>pull request</em>.</p>
<p>Introduce el nombre del <em>pull request</em>, el comentario, el <em>milestone</em>,
la etiqueta y el proyecto. En el comentario escribe</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>Closes #1
</pre></div>
</td></tr></table>

<p><img src="./imagenes/pull-request-practica.png" width="700px"/></p>
<p>De esta forma, cuando se cierre el <em>pull request</em> se cerrará
automáticamente el <em>issue</em>. El número <code>#1</code> lo convierte GitHub en un
enlace al <em>issue</em> correspondiente. De esta forma podemos examinar el
<em>issue</em> resuelto por el PR.</p>
<p>En el proyecto el <em>pull request</em> se colocará automáticamente la
columna <code>In pull request</code>. Entra en el proyecto y archiva la tarjeta
con el <em>issue</em>, ya que la actividad de desarrollar la <em>feature</em> queda
representada por el <em>pull request</em>.</p>
<p>En este momento se debería hacer una revisión del código del pull
request y comprobar de forma automática que la integración con
<em>master</em> no introduce errores en los tests. Lo haremos en siguientes
prácticas.</p>
<p>GitHub informa de que no hay conflictos con la rama <code>master</code> y que es
posible hacer el merge. Pulsa el botón de <code>Merge</code> y confírmalo. </p>
<p><img src="./imagenes/merge-pull-request.png" width="600px"/></p>
<p>Borra la rama en GitHub, pulsando el botón correspondiente.</p>
<p><img src="./imagenes/merge-pull-request-1.png" width="600px"/></p>
<p>Este <em>merge</em> lo has hecho en GitHub. Debes por último integrarlo en tu
repositorio local. En el terminal:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>(acerca-de) $ git checkout master
(master) $ git pull (bajamos los cambios)
(master) $ git branch -d acerca-de (borramos la rama)
(master) $ git remote prune origin (borramos referencias a rama remota)
(master) $ git log --oneline --graph --all
    *   9527ae2 (HEAD -&gt; master, origin/master, origin/HEAD) Merge pull request #2 from mads-ua-18/acerca-de
    |\  
    | * 672c28f Añadido enlace a página &#39;about&#39; en página &#39;login&#39;
    | * 3fdfb83 Añadida ruta, vista y controller &#39;about&#39;
    | * a332017 Cambiado el nombre del proyecto y empezamos versión 1.0.0
    |/  
    * 6767016 Commit inicial
</pre></div>
</td></tr></table>

<p>Comprobamos también la historia de <em>commits</em> en GitHub. Aparecerá el
<em>commit</em> de <em>merge</em> introducido por el <em>pull request</em>.</p>
<p><img src="./imagenes/historia-commits-practica1.png" width="800px"/></p>
<p>De esta forma hemos cerrado el PR e integrado su código en la rama
principal de desarrollo. En el tablero de proyecto debe haber cambiado
la tarjeta con el PR a la columna <code>Done</code>.</p>
<h4>Actualizamos tablero Trello</h4>
<p>Actualizamos el tablero Trello moviendo la historia de usuario a la
columna <em>Terminadas</em>.</p>
<p><img src="./imagenes/trello-terminadas.png" width="600px"/></p>
<h4>Versión 1.0.1</h4>
<p>Por último creamos el <em>release</em> 1.0.1. Haremos un commit directamente
sobre la rama <code>master</code> (más adelante explicaremos una forma más
elaborada de hacer un <em>release</em>, cuando expliquemos el flujo de
trabajo de GitFlow).</p>
<p>Crea un commit con la confirmación del número de versión y fecha en
los ficheros <code>pom.xml</code> y <code>about.html</code></p>
<p><strong>Fichero <code>pom.xml</code></strong>:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>     &lt;groupId&gt;es.ua.mads&lt;/groupId&gt;
     &lt;artifactId&gt;mads-todolist-dgallardo&lt;/artifactId&gt;
<span class="gd">-    &lt;version&gt;1.0.1-SNAPSHOT&lt;/version&gt;</span>
<span class="gi">+    &lt;version&gt;1.0.1&lt;/version&gt;</span>
</pre></div>
</td></tr></table>

<p><strong>Fichero <code>about.html</code></strong>:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    &lt;h1&gt;ToDo List&lt;/h1&gt;
        &lt;ul&gt;
         &lt;h1&gt;ToDo List&lt;/h1&gt;
         &lt;ul&gt;
             &lt;li&gt;Desarrollada por Domingo Gallardo&lt;/li&gt;
<span class="gd">-            &lt;li&gt;Versión 1.0.1 (en desarrollo)&lt;/li&gt;</span>
<span class="gd">-            &lt;li&gt;Fecha de release: pendiente de release&lt;/li&gt;</span>
<span class="gi">+            &lt;li&gt;Versión 1.0.1&lt;/li&gt;</span>
<span class="gi">+            &lt;li&gt;Fecha de release: 17/9/2018&lt;/li&gt;</span>
         &lt;/ul&gt;
}
</pre></div>
</td></tr></table>

<p>Añadimos el commit y lo subimos a GitHub</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>(master) $ git add .
(master) $ git commit -m &quot;Cambio de versión a 1.0.1&quot;
(master) $ git push
</pre></div>
</td></tr></table>

<p>Y, por último, creamos la versión 1.0.1 en GitHub pulsando en el
enlace <code>release</code> en la página principal (pestaña <code>Code</code>).</p>
<p><img src="./imagenes/release-practica1.png" width="700px"/></p>
<p>Un <em>release</em> en GitHub se guarda como una una etiqueta Git, junto con
información asociada. Se suelen indicar las nuevas <em>features</em> añadidas
en el <em>release</em> mediante enlaces a los <em>pull requests</em>
añadidos. También añadiremos enlaces a la página de la Wiki en la que
se describe la característica.</p>
<p><img src="./imagenes/primer-release-practica1.png" width="700px"/></p>
<p>El resultado será:</p>
<p><img src="./imagenes/release-practica1-terminado.png" width="400px"/></p>
<h3 id="resto-de-la-practica-version-110">Resto de la práctica (versión 1.1.0)<a class="headerlink" href="#resto-de-la-practica-version-110" title="Permanent link">&para;</a></h3>
<p>El resto de la práctica consistirá en desarrollar la versión 1.1.0,
usando la misma metodología vista anteriormente.</p>
<p>Deberás desarrollar tres características nuevas obligatorias y 3 opcionales:</p>
<ul>
<li>(Obligatoria) Barra de menú</li>
<li>(Obligatoria) Página de listado de usuarios</li>
<li>(Obligatoria) Página de descripción de un usuario</li>
<li>(Opcional) Usuario administrador </li>
<li>(Opcional) Protección listado y descripción de usuario</li>
<li>(Opcional) Administrador puede bloquear el acceso a usuarios</li>
</ul>
<p>Deberás implementar cada característica siguiendo la metodología que
hemos usado anteriormente. En la implementación, deberás añadir el
código necesario en cada una de las capas de la aplicación:</p>
<ul>
<li>Capa de presentación (vista)</li>
<li>Nuevo método en la capa de controller</li>
<li>Métodos necesarios en la capa de servicio y de repository</li>
</ul>
<p>En cada característica deberás también incluir <strong>tests</strong> que prueben los
nuevos métodos añadidos en la capa de servicio. En alguna de las
características deberás también realizar algún test de la vista.</p>
<h4>Barra de menú</h4>
<p>La aplicación deberá tener una barra de menú común a todas sus
páginas, menos en las páginas de login y registro.</p>
<ul>
<li>La barra de menú estará situada en la parte superior de la página y
será un <a href="https://getbootstrap.com/docs/4.0/components/navbar/">Navbar</a>.
de Bootstrap.</li>
<li>La barra de menú tendrá como mínimo los siguientes elementos (de
izquierda a derecha):</li>
<li><code>ToDoList</code>: enlace a la página <em>acerca de</em>.</li>
<li><code>Tareas</code>: enlace a la página de tareas, con la lista de tareas
  pendientes del usuario.</li>
<li><em>Nombre usuario</em>: A la derecha de la página. Desplegable con las opciones:<ul>
<li><code>Cuenta</code>: Futura página para gestionar la cuenta</li>
<li><code>Cerrar sesión &lt;nombre usuario&gt;</code>: cierra la sesión y lleva a la
 página de login.</li>
</ul>
</li>
</ul>
<h4>Listado de usuarios</h4>
<ul>
<li>Si se introduce la URL <code>/usuarios</code> aparecerá un listado de los
  usuarios registrados (identificador y correo electrónico).</li>
</ul>
<h4>Descripción de usuario</h4>
<ul>
<li>En la lista de usuarios habrá un enlace para acceder a su descripción.</li>
<li>En la descripción de un usuario aparecerán todos sus datos, menos la contraseña.</li>
<li>La ruta para obtener la descripción de un usuario será
<code>/usuarios/:id</code>. </li>
</ul>
<h4>Usuario administrador (opcional)</h4>
<p>Al realizar el registro será posible darse de alta como usuario
administrador.</p>
<ul>
<li>Para darse de alta como administrador se deberá activar un <em>check
  box</em> en la página de registro.</li>
<li>Sólo puede haber un administrador. Si ya existe un administrador, no
  debe aparecer el <em>check box</em> en la página de registro.</li>
<li>El usuario administrador accederá directamente a la lista de usuarios.</li>
</ul>
<h4>Protección de listado de usuario y descripción de usuario (opcional)</h4>
<ul>
<li>Proteger las páginas con el listado de usuarios y la descripción de
usuario para que sólo las pueda consultar el administrador.</li>
</ul>
<h4>Bloqueo de usuarios por usuario administrador (opcional)</h4>
<ul>
<li>Añadir en el listado de usuarios un botón para que el
  administrador pueda bloquear o habilitar el acceso a cada uno de los
  usuarios. </li>
<li>Si el usuario tiene bloqueado el acceso cuando intente logearse
  aparecerá un mensaje de error indicándoselo.</li>
</ul>
<h2 id="documentacion-entrega-y-evaluacion">Documentación, entrega y evaluación<a class="headerlink" href="#documentacion-entrega-y-evaluacion" title="Permanent link">&para;</a></h2>
<p>No es necesario, pero si quieres resaltar o documentar alguna cosa que
hayas hecho en la práctica puedes crear la página <code>/doc/practica1.md</code>
y escribir la documentación en Markdown. Tienes disponible en GitHub
una breve pero útil <a href="https://guides.github.com/features/mastering-markdown/">introducción a Markdown</a>.</p>
<ul>
<li>La práctica tiene una duración de 4 semanas y debe estar terminada
  el martes 15 de octubre.</li>
<li>La parte obligatoria puntúa sobre 6 y la opcional sobre 4 puntos.</li>
<li>La calificación de la práctica tiene un peso de un 10% en la nota
  final de la asignatura.</li>
<li>Para realizar la entrega se debe subir a Moodle un ZIP que contenga
  todo el proyecto, incluyendo el directorio <code>.git</code> que contiene la
  historia Git. Para ello comprime tu directorio local del proyecto
  <strong>después de haber hecho un <code>mvn clean</code></strong> para eliminar el
  directorio <code>target</code> que contiene los binarios compilados. Debes
  dejar también en Moodle la URL del repositorio en GitHub.</li>
</ul>
<p>Para la evaluación se tendrá en cuenta:</p>
<ul>
<li>Desarrollo continuo (los <em>commits</em> deben realizarse a lo largo de
  las 4 semanas y no dejar todo para la última semana).</li>
<li>Correcto desarrollo de la metodología.</li>
<li>Diseño e implementación del código y de los tests de las
  características desarrolladas.</li>
</ul>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="practica0.html" title="Práctica 0" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Anterior
                </span>
                Práctica 0
              </span>
            </div>
          </a>
        
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.dc02f8ce.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
  </body>
</html>